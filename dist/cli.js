#!/usr/bin/env node
var wr=Object.create;var Ti=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var br=Object.getOwnPropertyNames;var Sr=Object.getPrototypeOf,vr=Object.prototype.hasOwnProperty;var Oi=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var xr=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of br(t))!vr.call(s,r)&&r!==e&&Ti(s,r,{get:()=>t[r],enumerable:!(i=yr(t,r))||i.enumerable});return s};var Er=(s,t,e)=>(e=s!=null?wr(Sr(s)):{},xr(t||!s||!s.__esModule?Ti(e,"default",{value:s,enumerable:!0}):e,s));var Gi=Oi((Ga,Wi)=>{"use strict";Wi.exports=ji;function ji(s,t,e){s instanceof RegExp&&(s=Pi(s,e)),t instanceof RegExp&&(t=Pi(t,e));var i=Bi(s,t,e);return i&&{start:i[0],end:i[1],pre:e.slice(0,i[0]),body:e.slice(i[0]+s.length,i[1]),post:e.slice(i[1]+t.length)}}function Pi(s,t){var e=t.match(s);return e?e[0]:null}ji.range=Bi;function Bi(s,t,e){var i,r,n,o,a,l=e.indexOf(s),h=e.indexOf(t,l+1),c=l;if(l>=0&&h>0){if(s===t)return[l,h];for(i=[],n=e.length;c>=0&&!a;)c==l?(i.push(c),l=e.indexOf(s,c+1)):i.length==1?a=[i.pop(),h]:(r=i.pop(),r<n&&(n=r,o=h),h=e.indexOf(t,c+1)),c=l<h&&l>=0?l:h;i.length&&(a=[n,o])}return a}});var Vi=Oi((za,Ki)=>{var zi=Gi();Ki.exports=Ur;var Ui="\0SLASH"+Math.random()+"\0",Hi="\0OPEN"+Math.random()+"\0",He="\0CLOSE"+Math.random()+"\0",qi="\0COMMA"+Math.random()+"\0",Yi="\0PERIOD"+Math.random()+"\0";function Ue(s){return parseInt(s,10)==s?parseInt(s,10):s.charCodeAt(0)}function Gr(s){return s.split("\\\\").join(Ui).split("\\{").join(Hi).split("\\}").join(He).split("\\,").join(qi).split("\\.").join(Yi)}function zr(s){return s.split(Ui).join("\\").split(Hi).join("{").split(He).join("}").split(qi).join(",").split(Yi).join(".")}function Ji(s){if(!s)return[""];var t=[],e=zi("{","}",s);if(!e)return s.split(",");var i=e.pre,r=e.body,n=e.post,o=i.split(",");o[o.length-1]+="{"+r+"}";var a=Ji(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function Ur(s){return s?(s.substr(0,2)==="{}"&&(s="\\{\\}"+s.substr(2)),jt(Gr(s),!0).map(zr)):[]}function Hr(s){return"{"+s+"}"}function qr(s){return/^-?0\d/.test(s)}function Yr(s,t){return s<=t}function Jr(s,t){return s>=t}function jt(s,t){var e=[],i=zi("{","}",s);if(!i)return[s];var r=i.pre,n=i.post.length?jt(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<n.length;o++){var a=r+"{"+i.body+"}"+n[o];e.push(a)}else{var l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),h=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),c=l||h,f=i.body.indexOf(",")>=0;if(!c&&!f)return i.post.match(/,.*\}/)?(s=i.pre+"{"+i.body+He+i.post,jt(s)):[s];var d;if(c)d=i.body.split(/\.\./);else if(d=Ji(i.body),d.length===1&&(d=jt(d[0],!1).map(Hr),d.length===1))return n.map(function(V){return i.pre+d[0]+V});var p;if(c){var w=Ue(d[0]),m=Ue(d[1]),b=Math.max(d[0].length,d[1].length),g=d.length==3?Math.abs(Ue(d[2])):1,S=Yr,v=m<w;v&&(g*=-1,S=Jr);var y=d.some(qr);p=[];for(var x=w;S(x,m);x+=g){var E;if(h)E=String.fromCharCode(x),E==="\\"&&(E="");else if(E=String(x),y){var A=b-E.length;if(A>0){var j=new Array(A+1).join("0");x<0?E="-"+j+E.slice(1):E=j+E}}p.push(E)}}else{p=[];for(var $=0;$<d.length;$++)p.push.apply(p,jt(d[$],!1))}for(var $=0;$<p.length;$++)for(var o=0;o<n.length;o++){var a=r+p[$]+n[o];(!t||c||a)&&e.push(a)}}return e}});import{program as K}from"commander";import{config as ia}from"dotenv";var Ri=(s=0)=>t=>`\x1B[${t+s}m`,Fi=(s=0)=>t=>`\x1B[${38+s};5;${t}m`,Ai=(s=0)=>(t,e,i)=>`\x1B[${38+s};2;${t};${e};${i}m`,T={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},ra=Object.keys(T.modifier),Cr=Object.keys(T.color),Tr=Object.keys(T.bgColor),na=[...Cr,...Tr];function Or(){let s=new Map;for(let[t,e]of Object.entries(T)){for(let[i,r]of Object.entries(e))T[i]={open:`\x1B[${r[0]}m`,close:`\x1B[${r[1]}m`},e[i]=T[i],s.set(r[0],r[1]);Object.defineProperty(T,t,{value:e,enumerable:!1})}return Object.defineProperty(T,"codes",{value:s,enumerable:!1}),T.color.close="\x1B[39m",T.bgColor.close="\x1B[49m",T.color.ansi=Ri(),T.color.ansi256=Fi(),T.color.ansi16m=Ai(),T.bgColor.ansi=Ri(10),T.bgColor.ansi256=Fi(10),T.bgColor.ansi16m=Ai(10),Object.defineProperties(T,{rgbToAnsi256:{value(t,e,i){return t===e&&e===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(e/255*5)+Math.round(i/255*5)},enumerable:!1},hexToRgb:{value(t){let e=/[a-f\d]{6}|[a-f\d]{3}/i.exec(t.toString(16));if(!e)return[0,0,0];let[i]=e;i.length===3&&(i=[...i].map(n=>n+n).join(""));let r=Number.parseInt(i,16);return[r>>16&255,r>>8&255,r&255]},enumerable:!1},hexToAnsi256:{value:t=>T.rgbToAnsi256(...T.hexToRgb(t)),enumerable:!1},ansi256ToAnsi:{value(t){if(t<8)return 30+t;if(t<16)return 90+(t-8);let e,i,r;if(t>=232)e=((t-232)*10+8)/255,i=e,r=e;else{t-=16;let a=t%36;e=Math.floor(t/36)/5,i=Math.floor(a/6)/5,r=a%6/5}let n=Math.max(e,i,r)*2;if(n===0)return 30;let o=30+(Math.round(r)<<2|Math.round(i)<<1|Math.round(e));return n===2&&(o+=60),o},enumerable:!1},rgbToAnsi:{value:(t,e,i)=>T.ansi256ToAnsi(T.rgbToAnsi256(t,e,i)),enumerable:!1},hexToAnsi:{value:t=>T.ansi256ToAnsi(T.hexToAnsi256(t)),enumerable:!1}}),T}var Rr=Or(),X=Rr;import Pe from"node:process";import Fr from"node:os";import $i from"node:tty";function U(s,t=globalThis.Deno?globalThis.Deno.args:Pe.argv){let e=s.startsWith("-")?"":s.length===1?"-":"--",i=t.indexOf(e+s),r=t.indexOf("--");return i!==-1&&(r===-1||i<r)}var{env:O}=Pe,ae;U("no-color")||U("no-colors")||U("color=false")||U("color=never")?ae=0:(U("color")||U("colors")||U("color=true")||U("color=always"))&&(ae=1);function Ar(){if("FORCE_COLOR"in O)return O.FORCE_COLOR==="true"?1:O.FORCE_COLOR==="false"?0:O.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(O.FORCE_COLOR,10),3)}function $r(s){return s===0?!1:{level:s,hasBasic:!0,has256:s>=2,has16m:s>=3}}function Nr(s,{streamIsTTY:t,sniffFlags:e=!0}={}){let i=Ar();i!==void 0&&(ae=i);let r=e?ae:i;if(r===0)return 0;if(e){if(U("color=16m")||U("color=full")||U("color=truecolor"))return 3;if(U("color=256"))return 2}if("TF_BUILD"in O&&"AGENT_NAME"in O)return 1;if(s&&!t&&r===void 0)return 0;let n=r||0;if(O.TERM==="dumb")return n;if(Pe.platform==="win32"){let o=Fr.release().split(".");return Number(o[0])>=10&&Number(o[2])>=10586?Number(o[2])>=14931?3:2:1}if("CI"in O)return["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some(o=>o in O)?3:["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(o=>o in O)||O.CI_NAME==="codeship"?1:n;if("TEAMCITY_VERSION"in O)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(O.TEAMCITY_VERSION)?1:0;if(O.COLORTERM==="truecolor"||O.TERM==="xterm-kitty")return 3;if("TERM_PROGRAM"in O){let o=Number.parseInt((O.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(O.TERM_PROGRAM){case"iTerm.app":return o>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(O.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(O.TERM)||"COLORTERM"in O?1:n}function Ni(s,t={}){let e=Nr(s,{streamIsTTY:s&&s.isTTY,...t});return $r(e)}var Lr={stdout:Ni({isTTY:$i.isatty(1)}),stderr:Ni({isTTY:$i.isatty(2)})},Li=Lr;function Ii(s,t,e){let i=s.indexOf(t);if(i===-1)return s;let r=t.length,n=0,o="";do o+=s.slice(n,i)+t+e,n=i+r,i=s.indexOf(t,n);while(i!==-1);return o+=s.slice(n),o}function ki(s,t,e,i){let r=0,n="";do{let o=s[i-1]==="\r";n+=s.slice(r,o?i-1:i)+t+(o?`\r
`:`
`)+e,r=i+1,i=s.indexOf(`
`,r)}while(i!==-1);return n+=s.slice(r),n}var{stdout:Di,stderr:Mi}=Li,je=Symbol("GENERATOR"),St=Symbol("STYLER"),Dt=Symbol("IS_EMPTY"),_i=["ansi","ansi","ansi256","ansi16m"],vt=Object.create(null),Ir=(s,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let e=Di?Di.level:0;s.level=t.level===void 0?e:t.level};var kr=s=>{let t=(...e)=>e.join(" ");return Ir(t,s),Object.setPrototypeOf(t,Mt.prototype),t};function Mt(s){return kr(s)}Object.setPrototypeOf(Mt.prototype,Function.prototype);for(let[s,t]of Object.entries(X))vt[s]={get(){let e=le(this,We(t.open,t.close,this[St]),this[Dt]);return Object.defineProperty(this,s,{value:e}),e}};vt.visible={get(){let s=le(this,this[St],!0);return Object.defineProperty(this,"visible",{value:s}),s}};var Be=(s,t,e,...i)=>s==="rgb"?t==="ansi16m"?X[e].ansi16m(...i):t==="ansi256"?X[e].ansi256(X.rgbToAnsi256(...i)):X[e].ansi(X.rgbToAnsi(...i)):s==="hex"?Be("rgb",t,e,...X.hexToRgb(...i)):X[e][s](...i),Dr=["rgb","hex","ansi256"];for(let s of Dr){vt[s]={get(){let{level:e}=this;return function(...i){let r=We(Be(s,_i[e],"color",...i),X.color.close,this[St]);return le(this,r,this[Dt])}}};let t="bg"+s[0].toUpperCase()+s.slice(1);vt[t]={get(){let{level:e}=this;return function(...i){let r=We(Be(s,_i[e],"bgColor",...i),X.bgColor.close,this[St]);return le(this,r,this[Dt])}}}}var Mr=Object.defineProperties(()=>{},{...vt,level:{enumerable:!0,get(){return this[je].level},set(s){this[je].level=s}}}),We=(s,t,e)=>{let i,r;return e===void 0?(i=s,r=t):(i=e.openAll+s,r=t+e.closeAll),{open:s,close:t,openAll:i,closeAll:r,parent:e}},le=(s,t,e)=>{let i=(...r)=>_r(i,r.length===1?""+r[0]:r.join(" "));return Object.setPrototypeOf(i,Mr),i[je]=s,i[St]=t,i[Dt]=e,i},_r=(s,t)=>{if(s.level<=0||!t)return s[Dt]?"":t;let e=s[St];if(e===void 0)return t;let{openAll:i,closeAll:r}=e;if(t.includes("\x1B"))for(;e!==void 0;)t=Ii(t,e.close,e.open),e=e.parent;let n=t.indexOf(`
`);return n!==-1&&(t=ki(t,r,i,n)),i+t+r};Object.defineProperties(Mt.prototype,vt);var Pr=Mt(),ma=Mt({level:Mi?Mi.level:0});var C=Pr;var u={info:s=>console.log(C.blue(s)),success:s=>console.log(C.green(s)),error:s=>console.error(C.red(s)),debug:s=>console.log(C.gray(s)),warn:s=>console.log(C.yellow(s))};function H(){if(u.debug("Checking for GITHUB_TOKEN..."),!process.env.GITHUB_TOKEN)throw new Error("GITHUB_TOKEN is not set in .env file");if(process.env.GITHUB_TOKEN==="your_github_token_here")throw new Error("GITHUB_TOKEN is still set to the default value. Please update it in .env file");u.debug("GITHUB_TOKEN validation passed")}async function it(s,t={}){let e=`${ot}${s}`,i=await fetch(e,{headers:{Authorization:`token ${process.env.GITHUB_TOKEN}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},...t});if(!i.ok){let r=await i.text();throw u.error(`GitHub API Error: ${i.status} ${i.statusText}`),u.debug(`Response: ${r}`),i.status===404?new Error("Repository or path not found"):i.status===401?new Error("Invalid GitHub token or missing permissions"):i.status===403?new Error("API rate limit exceeded or insufficient permissions"):new Error(`GitHub API error: ${i.status} ${i.statusText}`)}return i.json()}async function Ge(s,t,e,i){u.debug(`Creating commit in ${s}/${t}...`);try{let n=(await it(`/repos/${s}/${t}`)).default_branch;u.debug(`Default branch: ${n}`);let o=await it(`/repos/${s}/${t}/git/ref/heads/${n}`);u.debug(`Current ref: ${o.object.sha}`);let a=await it(`/repos/${s}/${t}/git/commits/${o.object.sha}`);u.debug(`Parent commit: ${a.sha}`);let l=await it(`/repos/${s}/${t}/git/trees`,{method:"POST",body:JSON.stringify({base_tree:a.tree.sha,tree:i})});u.debug(`Created tree: ${l.sha}`);let h=await it(`/repos/${s}/${t}/git/commits`,{method:"POST",body:JSON.stringify({message:e,tree:l.sha,parents:[a.sha]})});return u.debug(`Created commit: ${h.sha}`),await it(`/repos/${s}/${t}/git/refs/heads/${n}`,{method:"PATCH",body:JSON.stringify({sha:h.sha})}),u.debug("Updated ref to new commit"),h}catch(r){throw u.error(`Failed to create commit: ${r.message}`),r}}var jr=3,Br=1e3;async function wt(s,t={},e=jr){try{let i=await fetch(s,{...t,headers:{Authorization:`token ${process.env.GITHUB_TOKEN}`,Accept:"application/vnd.github.v3+json","User-Agent":"GitHub-CLI",...t.headers}});if(!i.ok){let r=await i.text();throw new Error(`HTTP ${i.status}: ${r}`)}return i.json()}catch(i){if(e>0&&(i.message.includes("ECONNRESET")||i.message.includes("timeout")))return u.debug(`Retrying request to ${s}, ${e} attempts remaining`),await new Promise(r=>setTimeout(r,Br)),wt(s,t,e-1);throw i}}async function ze(s,t,e=""){u.debug(`Downloading contents for ${s}/${t}/${e}...`);try{let i=await wt(`${ot}/repos/${s}/${t}/contents/${e}`);if(!Array.isArray(i))return i.content&&(i.content=Buffer.from(i.content,"base64").toString("utf-8")),[i];let r=i.map(async n=>{if(n.type==="file"&&n.download_url){let o=await wt(n.url);o.content&&(n.content=Buffer.from(o.content,"base64").toString("utf-8"))}return n});return Promise.all(r)}catch(i){throw u.error(`Failed to download contents: ${i.message}`),i}}var ot="https://api.github.com";async function xt(s,t){return u.debug(`Fetching repository info for ${s}/${t}...`),it(`/repos/${s}/${t}`)}async function _t(s,t,e="",i=""){u.debug(`Fetching contents for ${s}/${t}/${e}...`);let r=i?`?ref=${i}`:"";return it(`/repos/${s}/${t}/contents/${e}${r}`)}import Pt from"fs";import Wr from"path";function ut(s){Pt.existsSync(s)||(Pt.mkdirSync(s,{recursive:!0}),u.debug(`Created directory: ${s}`))}function at(s,t){ut(Wr.dirname(s)),Pt.writeFileSync(s,t),u.debug(`Created file: ${s}`)}function he(s){Pt.existsSync(s)||(Pt.mkdirSync(s,{recursive:!0}),u.debug(`Created directory: ${s}`))}import $e from"fs";import _s from"path";var rs=Er(Vi(),1);var Bt=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")};var Kr={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Wt=s=>s.replace(/[[\]\\-]/g,"\\$&"),Vr=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Xi=s=>s.join(""),Zi=(s,t)=>{let e=t;if(s.charAt(e)!=="[")throw new Error("not in a brace expression");let i=[],r=[],n=e+1,o=!1,a=!1,l=!1,h=!1,c=e,f="";t:for(;n<s.length;){let m=s.charAt(n);if((m==="!"||m==="^")&&n===e+1){h=!0,n++;continue}if(m==="]"&&o&&!l){c=n+1;break}if(o=!0,m==="\\"&&!l){l=!0,n++;continue}if(m==="["&&!l){for(let[b,[g,S,v]]of Object.entries(Kr))if(s.startsWith(b,n)){if(f)return["$.",!1,s.length-e,!0];n+=b.length,v?r.push(g):i.push(g),a=a||S;continue t}}if(l=!1,f){m>f?i.push(Wt(f)+"-"+Wt(m)):m===f&&i.push(Wt(m)),f="",n++;continue}if(s.startsWith("-]",n+1)){i.push(Wt(m+"-")),n+=2;continue}if(s.startsWith("-",n+1)){f=m,n+=2;continue}i.push(Wt(m)),n++}if(c<n)return["",!1,0,!1];if(!i.length&&!r.length)return["$.",!1,s.length-e,!0];if(r.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!h){let m=i[0].length===2?i[0].slice(-1):i[0];return[Vr(m),!1,c-e,!1]}let d="["+(h?"^":"")+Xi(i)+"]",p="["+(h?"":"^")+Xi(r)+"]";return[i.length&&r.length?"("+d+"|"+p+")":i.length?d:p,a,c-e,!0]};var Z=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Xr=new Set(["!","?","+","*","@"]),Qi=s=>Xr.has(s),Zr="(?!(?:^|/)\\.\\.?(?:$|/))",ce="(?!\\.)",Qr=new Set(["[","."]),tn=new Set(["..","."]),en=new Set("().*{}+?[]^$\\!"),sn=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),qe="[^/]",ts=qe+"*?",es=qe+"+?",Et=class s{type;#t;#e;#n=!1;#s=[];#o;#S;#h;#f=!1;#a;#l;#r=!1;constructor(t,e,i={}){this.type=t,t&&(this.#e=!0),this.#o=e,this.#t=this.#o?this.#o.#t:this,this.#a=this.#t===this?i:this.#t.#a,this.#h=this.#t===this?[]:this.#t.#h,t==="!"&&!this.#t.#f&&this.#h.push(this),this.#S=this.#o?this.#o.#s.length:0}get hasMagic(){if(this.#e!==void 0)return this.#e;for(let t of this.#s)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return this.#l!==void 0?this.#l:this.type?this.#l=this.type+"("+this.#s.map(t=>String(t)).join("|")+")":this.#l=this.#s.map(t=>String(t)).join("")}#g(){if(this!==this.#t)throw new Error("should only call on root");if(this.#f)return this;this.toString(),this.#f=!0;let t;for(;t=this.#h.pop();){if(t.type!=="!")continue;let e=t,i=e.#o;for(;i;){for(let r=e.#S+1;!i.type&&r<i.#s.length;r++)for(let n of t.#s){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(i.#s[r])}e=i,i=e.#o}}return this}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof s&&e.#o===this))throw new Error("invalid part: "+e);this.#s.push(e)}}toJSON(){var e;let t=this.type===null?this.#s.slice().map(i=>typeof i=="string"?i:i.toJSON()):[this.type,...this.#s.map(i=>i.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#f&&((e=this.#o)==null?void 0:e.type)==="!")&&t.push({}),t}isStart(){var e;if(this.#t===this)return!0;if(!((e=this.#o)!=null&&e.isStart()))return!1;if(this.#S===0)return!0;let t=this.#o;for(let i=0;i<this.#S;i++){let r=t.#s[i];if(!(r instanceof s&&r.type==="!"))return!1}return!0}isEnd(){var e,i,r;if(this.#t===this||((e=this.#o)==null?void 0:e.type)==="!")return!0;if(!((i=this.#o)!=null&&i.isEnd()))return!1;if(!this.type)return(r=this.#o)==null?void 0:r.isEnd();let t=this.#o?this.#o.#s.length:0;return this.#S===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new s(this.type,t);for(let i of this.#s)e.copyIn(i);return e}static#w(t,e,i,r){let n=!1,o=!1,a=-1,l=!1;if(e.type===null){let p=i,w="";for(;p<t.length;){let m=t.charAt(p++);if(n||m==="\\"){n=!n,w+=m;continue}if(o){p===a+1?(m==="^"||m==="!")&&(l=!0):m==="]"&&!(p===a+2&&l)&&(o=!1),w+=m;continue}else if(m==="["){o=!0,a=p,l=!1,w+=m;continue}if(!r.noext&&Qi(m)&&t.charAt(p)==="("){e.push(w),w="";let b=new s(m,e);p=s.#w(t,b,p,r),e.push(b);continue}w+=m}return e.push(w),p}let h=i+1,c=new s(null,e),f=[],d="";for(;h<t.length;){let p=t.charAt(h++);if(n||p==="\\"){n=!n,d+=p;continue}if(o){h===a+1?(p==="^"||p==="!")&&(l=!0):p==="]"&&!(h===a+2&&l)&&(o=!1),d+=p;continue}else if(p==="["){o=!0,a=h,l=!1,d+=p;continue}if(Qi(p)&&t.charAt(h)==="("){c.push(d),d="";let w=new s(p,c);c.push(w),h=s.#w(t,w,h,r);continue}if(p==="|"){c.push(d),d="",f.push(c),c=new s(null,e);continue}if(p===")")return d===""&&e.#s.length===0&&(e.#r=!0),c.push(d),d="",e.push(...f,c),h;d+=p}return e.type=null,e.#e=void 0,e.#s=[t.substring(i-1)],h}static fromGlob(t,e={}){let i=new s(null,void 0,e);return s.#w(t,i,0,e),i}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();let t=this.toString(),[e,i,r,n]=this.toRegExpSource();if(!(r||this.#e||this.#a.nocase&&!this.#a.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;let a=(this.#a.nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${e}$`,a),{_src:e,_glob:t})}get options(){return this.#a}toRegExpSource(t){var l;let e=t??!!this.#a.dot;if(this.#t===this&&this.#g(),!this.type){let h=this.isStart()&&this.isEnd(),c=this.#s.map(w=>{let[m,b,g,S]=typeof w=="string"?s.#u(w,this.#e,h):w.toRegExpSource(t);return this.#e=this.#e||g,this.#n=this.#n||S,m}).join(""),f="";if(this.isStart()&&typeof this.#s[0]=="string"&&!(this.#s.length===1&&tn.has(this.#s[0]))){let m=Qr,b=e&&m.has(c.charAt(0))||c.startsWith("\\.")&&m.has(c.charAt(2))||c.startsWith("\\.\\.")&&m.has(c.charAt(4)),g=!e&&!t&&m.has(c.charAt(0));f=b?Zr:g?ce:""}let d="";return this.isEnd()&&this.#t.#f&&((l=this.#o)==null?void 0:l.type)==="!"&&(d="(?:$|\\/)"),[f+c+d,Z(c),this.#e=!!this.#e,this.#n]}let i=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:",n=this.#d(e);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){let h=this.toString();return this.#s=[h],this.type=null,this.#e=void 0,[h,Z(this.toString()),!1,!1]}let o=!i||t||e||!ce?"":this.#d(!0);o===n&&(o=""),o&&(n=`(?:${n})(?:${o})*?`);let a="";if(this.type==="!"&&this.#r)a=(this.isStart()&&!e?ce:"")+es;else{let h=this.type==="!"?"))"+(this.isStart()&&!e&&!t?ce:"")+ts+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;a=r+n+h}return[a,Z(n),this.#e=!!this.#e,this.#n]}#d(t){return this.#s.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[i,r,n,o]=e.toRegExpSource(t);return this.#n=this.#n||o,i}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#u(t,e,i=!1){let r=!1,n="",o=!1;for(let a=0;a<t.length;a++){let l=t.charAt(a);if(r){r=!1,n+=(en.has(l)?"\\":"")+l;continue}if(l==="\\"){a===t.length-1?n+="\\\\":r=!0;continue}if(l==="["){let[h,c,f,d]=Zi(t,a);if(f){n+=h,o=o||c,a+=f-1,e=e||d;continue}}if(l==="*"){i&&t==="*"?n+=es:n+=ts,e=!0;continue}if(l==="?"){n+=qe,e=!0;continue}n+=sn(l)}return[n,Z(t),!!e,o]}};var Ct=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&");var R=(s,t,e={})=>(Bt(t),!e.nocomment&&t.charAt(0)==="#"?!1:new W(t,e).match(s)),rn=/^\*+([^+@!?\*\[\(]*)$/,nn=s=>t=>!t.startsWith(".")&&t.endsWith(s),on=s=>t=>t.endsWith(s),an=s=>(s=s.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(s)),ln=s=>(s=s.toLowerCase(),t=>t.toLowerCase().endsWith(s)),hn=/^\*+\.\*+$/,cn=s=>!s.startsWith(".")&&s.includes("."),fn=s=>s!=="."&&s!==".."&&s.includes("."),un=/^\.\*+$/,dn=s=>s!=="."&&s!==".."&&s.startsWith("."),pn=/^\*+$/,mn=s=>s.length!==0&&!s.startsWith("."),gn=s=>s.length!==0&&s!=="."&&s!=="..",wn=/^\?+([^+@!?\*\[\(]*)?$/,yn=([s,t=""])=>{let e=ns([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},bn=([s,t=""])=>{let e=os([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},Sn=([s,t=""])=>{let e=os([s]);return t?i=>e(i)&&i.endsWith(t):e},vn=([s,t=""])=>{let e=ns([s]);return t?i=>e(i)&&i.endsWith(t):e},ns=([s])=>{let t=s.length;return e=>e.length===t&&!e.startsWith(".")},os=([s])=>{let t=s.length;return e=>e.length===t&&e!=="."&&e!==".."},as=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",is={win32:{sep:"\\"},posix:{sep:"/"}},xn=as==="win32"?is.win32.sep:is.posix.sep;R.sep=xn;var k=Symbol("globstar **");R.GLOBSTAR=k;var En="[^/]",Cn=En+"*?",Tn="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",On="(?:(?!(?:\\/|^)\\.).)*?",Rn=(s,t={})=>e=>R(e,s,t);R.filter=Rn;var q=(s,t={})=>Object.assign({},s,t),Fn=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return R;let t=R;return Object.assign((i,r,n={})=>t(i,r,q(s,n)),{Minimatch:class extends t.Minimatch{constructor(r,n={}){super(r,q(s,n))}static defaults(r){return t.defaults(q(s,r)).Minimatch}},AST:class extends t.AST{constructor(r,n,o={}){super(r,n,q(s,o))}static fromGlob(r,n={}){return t.AST.fromGlob(r,q(s,n))}},unescape:(i,r={})=>t.unescape(i,q(s,r)),escape:(i,r={})=>t.escape(i,q(s,r)),filter:(i,r={})=>t.filter(i,q(s,r)),defaults:i=>t.defaults(q(s,i)),makeRe:(i,r={})=>t.makeRe(i,q(s,r)),braceExpand:(i,r={})=>t.braceExpand(i,q(s,r)),match:(i,r,n={})=>t.match(i,r,q(s,n)),sep:t.sep,GLOBSTAR:k})};R.defaults=Fn;var ls=(s,t={})=>(Bt(s),t.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:(0,rs.default)(s));R.braceExpand=ls;var An=(s,t={})=>new W(s,t).makeRe();R.makeRe=An;var $n=(s,t,e={})=>{let i=new W(t,e);return s=s.filter(r=>i.match(r)),i.options.nonull&&!s.length&&s.push(t),s};R.match=$n;var ss=/[?*]|[+@!]\(.*?\)|\[|\]/,Nn=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),W=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){Bt(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||as,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let i=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let r=this.globParts.map((n,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let l=n[0]===""&&n[1]===""&&(n[2]==="?"||!ss.test(n[2]))&&!ss.test(n[3]),h=/^[a-z]:/i.test(n[0]);if(l)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(h)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(l=>this.parse(l))});if(this.debug(this.pattern,r),this.set=r.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let o=this.set[n];o[0]===""&&o[1]===""&&this.globParts[n][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let r=0;r<t[i].length;r++)t[i][r]==="**"&&(t[i][r]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let i=-1;for(;(i=e.indexOf("**",i+1))!==-1;){let r=i;for(;e[r+1]==="**";)r++;r!==i&&e.splice(i,r-i)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((i,r)=>{let n=i[i.length-1];return r==="**"&&n==="**"?i:r===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(i.pop(),i):(i.push(r),i)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let r=1;r<t.length-1;r++){let n=t[r];r===1&&n===""&&t[0]===""||(n==="."||n==="")&&(e=!0,t.splice(r,1),r--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let i=0;for(;(i=t.indexOf("..",i+1))!==-1;){let r=t[i-1];r&&r!=="."&&r!==".."&&r!=="**"&&(e=!0,t.splice(i-1,2),i-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let r=-1;for(;(r=i.indexOf("**",r+1))!==-1;){let o=r;for(;i[o+1]==="**";)o++;o>r&&i.splice(r+1,o-r);let a=i[r+1],l=i[r+2],h=i[r+3];if(a!==".."||!l||l==="."||l===".."||!h||h==="."||h==="..")continue;e=!0,i.splice(r,1);let c=i.slice(0);c[r]="**",t.push(c),r--}if(!this.preserveMultipleSlashes){for(let o=1;o<i.length-1;o++){let a=i[o];o===1&&a===""&&i[0]===""||(a==="."||a==="")&&(e=!0,i.splice(o,1),o--)}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(e=!0,i.pop())}let n=0;for(;(n=i.indexOf("..",n+1))!==-1;){let o=i[n-1];if(o&&o!=="."&&o!==".."&&o!=="**"){e=!0;let l=n===1&&i[n+1]==="**"?["."]:[];i.splice(n-1,2,...l),i.length===0&&i.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){let r=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);if(r){t[e]=[],t[i]=r;break}}return t.filter(e=>e.length)}partsMatch(t,e,i=!1){let r=0,n=0,o=[],a="";for(;r<t.length&&n<e.length;)if(t[r]===e[n])o.push(a==="b"?e[n]:t[r]),r++,n++;else if(i&&t[r]==="**"&&e[n]===t[r+1])o.push(t[r]),r++;else if(i&&e[n]==="**"&&t[r]===e[n+1])o.push(e[n]),n++;else if(t[r]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(a==="b")return!1;a="a",o.push(t[r]),r++,n++}else if(e[n]==="*"&&t[r]&&(this.options.dot||!t[r].startsWith("."))&&t[r]!=="**"){if(a==="a")return!1;a="b",o.push(e[n]),r++,n++}else return!1;return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,i=0;for(let r=0;r<t.length&&t.charAt(r)==="!";r++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e}matchOne(t,e,i=!1){let r=this.options;if(this.isWindows){let m=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),b=!m&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),g=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),S=!g&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),v=b?3:m?0:void 0,y=S?3:g?0:void 0;if(typeof v=="number"&&typeof y=="number"){let[x,E]=[t[v],e[y]];x.toLowerCase()===E.toLowerCase()&&(e[y]=x,y>v?e=e.slice(y):v>y&&(t=t.slice(v)))}}let{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,a=0,l=t.length,h=e.length;o<l&&a<h;o++,a++){this.debug("matchOne loop");var c=e[a],f=t[o];if(this.debug(e,c,f),c===!1)return!1;if(c===k){this.debug("GLOBSTAR",[e,c,f]);var d=o,p=a+1;if(p===h){for(this.debug("** at the end");o<l;o++)if(t[o]==="."||t[o]===".."||!r.dot&&t[o].charAt(0)===".")return!1;return!0}for(;d<l;){var w=t[d];if(this.debug(`
globstar while`,t,d,e,p,w),this.matchOne(t.slice(d),e.slice(p),i))return this.debug("globstar found match!",d,l,w),!0;if(w==="."||w===".."||!r.dot&&w.charAt(0)==="."){this.debug("dot detected!",t,d,e,p);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(i&&(this.debug(`
>>> no match, partial?`,t,d,e,p),d===l))}let m;if(typeof c=="string"?(m=f===c,this.debug("string match",c,f,m)):(m=c.test(f),this.debug("pattern match",c,f,m)),!m)return!1}if(o===l&&a===h)return!0;if(o===l)return i;if(a===h)return o===l-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return ls(this.pattern,this.options)}parse(t){Bt(t);let e=this.options;if(t==="**")return k;if(t==="")return"";let i,r=null;(i=t.match(pn))?r=e.dot?gn:mn:(i=t.match(rn))?r=(e.nocase?e.dot?ln:an:e.dot?on:nn)(i[1]):(i=t.match(wn))?r=(e.nocase?e.dot?bn:yn:e.dot?Sn:vn)(i):(i=t.match(hn))?r=e.dot?fn:cn:(i=t.match(un))&&(r=dn);let n=Et.fromGlob(t,this.options).toMMPattern();return r&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:r}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,i=e.noglobstar?Cn:e.dot?Tn:On,r=new Set(e.nocase?["i"]:[]),n=t.map(l=>{let h=l.map(c=>{if(c instanceof RegExp)for(let f of c.flags.split(""))r.add(f);return typeof c=="string"?Nn(c):c===k?k:c._src});return h.forEach((c,f)=>{let d=h[f+1],p=h[f-1];c!==k||p===k||(p===void 0?d!==void 0&&d!==k?h[f+1]="(?:\\/|"+i+"\\/)?"+d:h[f]=i:d===void 0?h[f-1]=p+"(?:\\/|"+i+")?":d!==k&&(h[f-1]=p+"(?:\\/|\\/"+i+"\\/)"+d,h[f+1]=k))}),h.filter(c=>c!==k).join("/")}).join("|"),[o,a]=t.length>1?["(?:",")"]:["",""];n="^"+o+n+a+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let i=this.options;this.isWindows&&(t=t.split("\\").join("/"));let r=this.slashSplit(t);this.debug(this.pattern,"split",r);let n=this.set;this.debug(this.pattern,"set",n);let o=r[r.length-1];if(!o)for(let a=r.length-2;!o&&a>=0;a--)o=r[a];for(let a=0;a<n.length;a++){let l=n[a],h=r;if(i.matchBase&&l.length===1&&(h=[o]),this.matchOne(h,l,e))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(t){return R.defaults(t).Minimatch}};R.AST=Et;R.Minimatch=W;R.escape=Ct;R.unescape=Z;import{fileURLToPath as ho}from"node:url";var Tt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,fs=new Set,Ye=typeof process=="object"&&process?process:{},us=(s,t,e,i)=>{typeof Ye.emitWarning=="function"?Ye.emitWarning(s,t,e,i):console.error(`[${e}] ${t}: ${s}`)},fe=globalThis.AbortController,hs=globalThis.AbortSignal,cs;if(typeof fe>"u"){hs=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,r){this._onabort.push(r)}},fe=class{constructor(){t()}signal=new hs;abort(i){var r,n;if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(let o of this.signal._onabort)o(i);(n=(r=this.signal).onabort)==null||n.call(r,i)}}};let s=((cs=Ye.env)==null?void 0:cs.LRU_CACHE_IGNORE_AC_WARNING)!=="1",t=()=>{s&&(s=!1,us("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}var Ln=s=>!fs.has(s),hl=Symbol("type"),dt=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),ds=s=>dt(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?Ot:null:null,Ot=class extends Array{constructor(t){super(t),this.fill(0)}},Je=class s{heap;length;static#t=!1;static create(t){let e=ds(t);if(!e)return[];s.#t=!0;let i=new s(t,e);return s.#t=!1,i}constructor(t,e){if(!s.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},Gt=class s{#t;#e;#n;#s;#o;#S;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#h;#f;#a;#l;#r;#g;#w;#d;#u;#E;#m;#C;#T;#b;#v;#x;#p;static unsafeExposeInternals(t){return{starts:t.#T,ttls:t.#b,sizes:t.#C,keyMap:t.#a,keyList:t.#l,valList:t.#r,next:t.#g,prev:t.#w,get head(){return t.#d},get tail(){return t.#u},free:t.#E,isBackgroundFetch:e=>t.#c(e),backgroundFetch:(e,i,r,n)=>t.#P(e,i,r,n),moveToTail:e=>t.#B(e),indexes:e=>t.#R(e),rindexes:e=>t.#F(e),isStale:e=>t.#y(e)}}get max(){return this.#t}get maxSize(){return this.#e}get calculatedSize(){return this.#f}get size(){return this.#h}get fetchMethod(){return this.#o}get memoMethod(){return this.#S}get dispose(){return this.#n}get disposeAfter(){return this.#s}constructor(t){let{max:e=0,ttl:i,ttlResolution:r=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:h,disposeAfter:c,noDisposeOnSet:f,noUpdateTTL:d,maxSize:p=0,maxEntrySize:w=0,sizeCalculation:m,fetchMethod:b,memoMethod:g,noDeleteOnFetchRejection:S,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:y,allowStaleOnFetchAbort:x,ignoreFetchAbort:E}=t;if(e!==0&&!dt(e))throw new TypeError("max option must be a nonnegative integer");let A=e?ds(e):Array;if(!A)throw new Error("invalid max value: "+e);if(this.#t=e,this.#e=p,this.maxEntrySize=w||this.#e,this.sizeCalculation=m,this.sizeCalculation){if(!this.#e&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(g!==void 0&&typeof g!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#S=g,b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#o=b,this.#x=!!b,this.#a=new Map,this.#l=new Array(e).fill(void 0),this.#r=new Array(e).fill(void 0),this.#g=new A(e),this.#w=new A(e),this.#d=0,this.#u=0,this.#E=Je.create(e),this.#h=0,this.#f=0,typeof h=="function"&&(this.#n=h),typeof c=="function"?(this.#s=c,this.#m=[]):(this.#s=void 0,this.#m=void 0),this.#v=!!this.#n,this.#p=!!this.#s,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!S,this.allowStaleOnFetchRejection=!!y,this.allowStaleOnFetchAbort=!!x,this.ignoreFetchAbort=!!E,this.maxEntrySize!==0){if(this.#e!==0&&!dt(this.#e))throw new TypeError("maxSize must be a positive integer if specified");if(!dt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#$()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=dt(r)||r===0?r:1,this.ttlAutopurge=!!n,this.ttl=i||0,this.ttl){if(!dt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#t===0&&this.ttl===0&&this.#e===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#e){let j="LRU_CACHE_UNBOUNDED";Ln(j)&&(fs.add(j),us("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",j,s))}}getRemainingTTL(t){return this.#a.has(t)?1/0:0}#A(){let t=new Ot(this.#t),e=new Ot(this.#t);this.#b=t,this.#T=e,this.#L=(n,o,a=Tt.now())=>{if(e[n]=o!==0?a:0,t[n]=o,o!==0&&this.ttlAutopurge){let l=setTimeout(()=>{this.#y(n)&&this.#N(this.#l[n],"expire")},o+1);l.unref&&l.unref()}},this.#O=n=>{e[n]=t[n]!==0?Tt.now():0},this.#i=(n,o)=>{if(t[o]){let a=t[o],l=e[o];if(!a||!l)return;n.ttl=a,n.start=l,n.now=i||r();let h=n.now-l;n.remainingTTL=a-h}};let i=0,r=()=>{let n=Tt.now();if(this.ttlResolution>0){i=n;let o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref()}return n};this.getRemainingTTL=n=>{let o=this.#a.get(n);if(o===void 0)return 0;let a=t[o],l=e[o];if(!a||!l)return 1/0;let h=(i||r())-l;return a-h},this.#y=n=>{let o=e[n],a=t[n];return!!a&&!!o&&(i||r())-o>a}}#O=()=>{};#i=()=>{};#L=()=>{};#y=()=>!1;#$(){let t=new Ot(this.#t);this.#f=0,this.#C=t,this.#I=e=>{this.#f-=t[e],t[e]=0},this.#D=(e,i,r,n)=>{if(this.#c(i))return 0;if(!dt(r))if(n){if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(r=n(i,e),!dt(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return r},this.#k=(e,i,r)=>{if(t[e]=i,this.#e){let n=this.#e-t[e];for(;this.#f>n;)this.#_(!0)}this.#f+=t[e],r&&(r.entrySize=i,r.totalCalculatedSize=this.#f)}}#I=t=>{};#k=(t,e,i)=>{};#D=(t,e,i,r)=>{if(i||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#R({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#u;!(!this.#M(e)||((t||!this.#y(e))&&(yield e),e===this.#d));)e=this.#w[e]}*#F({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#d;!(!this.#M(e)||((t||!this.#y(e))&&(yield e),e===this.#u));)e=this.#g[e]}#M(t){return t!==void 0&&this.#a.get(this.#l[t])===t}*entries(){for(let t of this.#R())this.#r[t]!==void 0&&this.#l[t]!==void 0&&!this.#c(this.#r[t])&&(yield[this.#l[t],this.#r[t]])}*rentries(){for(let t of this.#F())this.#r[t]!==void 0&&this.#l[t]!==void 0&&!this.#c(this.#r[t])&&(yield[this.#l[t],this.#r[t]])}*keys(){for(let t of this.#R()){let e=this.#l[t];e!==void 0&&!this.#c(this.#r[t])&&(yield e)}}*rkeys(){for(let t of this.#F()){let e=this.#l[t];e!==void 0&&!this.#c(this.#r[t])&&(yield e)}}*values(){for(let t of this.#R())this.#r[t]!==void 0&&!this.#c(this.#r[t])&&(yield this.#r[t])}*rvalues(){for(let t of this.#F())this.#r[t]!==void 0&&!this.#c(this.#r[t])&&(yield this.#r[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(let i of this.#R()){let r=this.#r[i],n=this.#c(r)?r.__staleWhileFetching:r;if(n!==void 0&&t(n,this.#l[i],this))return this.get(this.#l[i],e)}}forEach(t,e=this){for(let i of this.#R()){let r=this.#r[i],n=this.#c(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#l[i],this)}}rforEach(t,e=this){for(let i of this.#F()){let r=this.#r[i],n=this.#c(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#l[i],this)}}purgeStale(){let t=!1;for(let e of this.#F({allowStale:!0}))this.#y(e)&&(this.#N(this.#l[e],"expire"),t=!0);return t}info(t){let e=this.#a.get(t);if(e===void 0)return;let i=this.#r[e],r=this.#c(i)?i.__staleWhileFetching:i;if(r===void 0)return;let n={value:r};if(this.#b&&this.#T){let o=this.#b[e],a=this.#T[e];if(o&&a){let l=o-(Tt.now()-a);n.ttl=l,n.start=Date.now()}}return this.#C&&(n.size=this.#C[e]),n}dump(){let t=[];for(let e of this.#R({allowStale:!0})){let i=this.#l[e],r=this.#r[e],n=this.#c(r)?r.__staleWhileFetching:r;if(n===void 0||i===void 0)continue;let o={value:n};if(this.#b&&this.#T){o.ttl=this.#b[e];let a=Tt.now()-this.#T[e];o.start=Math.floor(Date.now()-a)}this.#C&&(o.size=this.#C[e]),t.unshift([i,o])}return t}load(t){this.clear();for(let[e,i]of t){if(i.start){let r=Date.now()-i.start;i.start=Tt.now()-r}this.set(e,i.value,i)}}set(t,e,i={}){var d,p,w,m,b;if(e===void 0)return this.delete(t),this;let{ttl:r=this.ttl,start:n,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=i,{noUpdateTTL:h=this.noUpdateTTL}=i,c=this.#D(t,e,i.size||0,a);if(this.maxEntrySize&&c>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#N(t,"set"),this;let f=this.#h===0?void 0:this.#a.get(t);if(f===void 0)f=this.#h===0?this.#u:this.#E.length!==0?this.#E.pop():this.#h===this.#t?this.#_(!1):this.#h,this.#l[f]=t,this.#r[f]=e,this.#a.set(t,f),this.#g[this.#u]=f,this.#w[f]=this.#u,this.#u=f,this.#h++,this.#k(f,c,l),l&&(l.set="add"),h=!1;else{this.#B(f);let g=this.#r[f];if(e!==g){if(this.#x&&this.#c(g)){g.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:S}=g;S!==void 0&&!o&&(this.#v&&((d=this.#n)==null||d.call(this,S,t,"set")),this.#p&&((p=this.#m)==null||p.push([S,t,"set"])))}else o||(this.#v&&((w=this.#n)==null||w.call(this,g,t,"set")),this.#p&&((m=this.#m)==null||m.push([g,t,"set"])));if(this.#I(f),this.#k(f,c,l),this.#r[f]=e,l){l.set="replace";let S=g&&this.#c(g)?g.__staleWhileFetching:g;S!==void 0&&(l.oldValue=S)}}else l&&(l.set="update")}if(r!==0&&!this.#b&&this.#A(),this.#b&&(h||this.#L(f,r,n),l&&this.#i(l,f)),!o&&this.#p&&this.#m){let g=this.#m,S;for(;S=g==null?void 0:g.shift();)(b=this.#s)==null||b.call(this,...S)}return this}pop(){var t;try{for(;this.#h;){let e=this.#r[this.#d];if(this.#_(!0),this.#c(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#p&&this.#m){let e=this.#m,i;for(;i=e==null?void 0:e.shift();)(t=this.#s)==null||t.call(this,...i)}}}#_(t){var n,o;let e=this.#d,i=this.#l[e],r=this.#r[e];return this.#x&&this.#c(r)?r.__abortController.abort(new Error("evicted")):(this.#v||this.#p)&&(this.#v&&((n=this.#n)==null||n.call(this,r,i,"evict")),this.#p&&((o=this.#m)==null||o.push([r,i,"evict"]))),this.#I(e),t&&(this.#l[e]=void 0,this.#r[e]=void 0,this.#E.push(e)),this.#h===1?(this.#d=this.#u=0,this.#E.length=0):this.#d=this.#g[e],this.#a.delete(i),this.#h--,e}has(t,e={}){let{updateAgeOnHas:i=this.updateAgeOnHas,status:r}=e,n=this.#a.get(t);if(n!==void 0){let o=this.#r[n];if(this.#c(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#y(n))r&&(r.has="stale",this.#i(r,n));else return i&&this.#O(n),r&&(r.has="hit",this.#i(r,n)),!0}else r&&(r.has="miss");return!1}peek(t,e={}){let{allowStale:i=this.allowStale}=e,r=this.#a.get(t);if(r===void 0||!i&&this.#y(r))return;let n=this.#r[r];return this.#c(n)?n.__staleWhileFetching:n}#P(t,e,i,r){let n=e===void 0?void 0:this.#r[e];if(this.#c(n))return n;let o=new fe,{signal:a}=i;a==null||a.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});let l={signal:o.signal,options:i,context:r},h=(m,b=!1)=>{let{aborted:g}=o.signal,S=i.ignoreFetchAbort&&m!==void 0;if(i.status&&(g&&!b?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,S&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),g&&!S&&!b)return f(o.signal.reason);let v=p;return this.#r[e]===p&&(m===void 0?v.__staleWhileFetching?this.#r[e]=v.__staleWhileFetching:this.#N(t,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(t,m,l.options))),m},c=m=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=m),f(m)),f=m=>{let{aborted:b}=o.signal,g=b&&i.allowStaleOnFetchAbort,S=g||i.allowStaleOnFetchRejection,v=S||i.noDeleteOnFetchRejection,y=p;if(this.#r[e]===p&&(!v||y.__staleWhileFetching===void 0?this.#N(t,"fetch"):g||(this.#r[e]=y.__staleWhileFetching)),S)return i.status&&y.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),y.__staleWhileFetching;if(y.__returned===y)throw m},d=(m,b)=>{var S;let g=(S=this.#o)==null?void 0:S.call(this,t,n,l);g&&g instanceof Promise&&g.then(v=>m(v===void 0?void 0:v),b),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(m(void 0),i.allowStaleOnFetchAbort&&(m=v=>h(v,!0)))})};i.status&&(i.status.fetchDispatched=!0);let p=new Promise(d).then(h,c),w=Object.assign(p,{__abortController:o,__staleWhileFetching:n,__returned:void 0});return e===void 0?(this.set(t,w,{...l.options,status:void 0}),e=this.#a.get(t)):this.#r[e]=w,w}#c(t){if(!this.#x)return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof fe}async fetch(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:w=this.allowStaleOnFetchAbort,context:m,forceRefresh:b=!1,status:g,signal:S}=e;if(!this.#x)return g&&(g.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:n,status:g});let v={allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:n,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:h,noUpdateTTL:c,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:w,ignoreFetchAbort:p,status:g,signal:S},y=this.#a.get(t);if(y===void 0){g&&(g.fetch="miss");let x=this.#P(t,y,v,m);return x.__returned=x}else{let x=this.#r[y];if(this.#c(x)){let V=i&&x.__staleWhileFetching!==void 0;return g&&(g.fetch="inflight",V&&(g.returnedStale=!0)),V?x.__staleWhileFetching:x.__returned=x}let E=this.#y(y);if(!b&&!E)return g&&(g.fetch="hit"),this.#B(y),r&&this.#O(y),g&&this.#i(g,y),x;let A=this.#P(t,y,v,m),$=A.__staleWhileFetching!==void 0&&i;return g&&(g.fetch=E?"stale":"refresh",$&&E&&(g.returnedStale=!0)),$?A.__staleWhileFetching:A.__returned=A}}async forceFetch(t,e={}){let i=await this.fetch(t,e);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(t,e={}){let i=this.#S;if(!i)throw new Error("no memoMethod provided to constructor");let{context:r,forceRefresh:n,...o}=e,a=this.get(t,o);if(!n&&a!==void 0)return a;let l=i(t,a,{options:o,context:r});return this.set(t,l,o),l}get(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:o}=e,a=this.#a.get(t);if(a!==void 0){let l=this.#r[a],h=this.#c(l);return o&&this.#i(o,a),this.#y(a)?(o&&(o.get="stale"),h?(o&&i&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?l.__staleWhileFetching:void 0):(n||this.#N(t,"expire"),o&&i&&(o.returnedStale=!0),i?l:void 0)):(o&&(o.get="hit"),h?l.__staleWhileFetching:(this.#B(a),r&&this.#O(a),l))}else o&&(o.get="miss")}#j(t,e){this.#w[e]=t,this.#g[t]=e}#B(t){t!==this.#u&&(t===this.#d?this.#d=this.#g[t]:this.#j(this.#w[t],this.#g[t]),this.#j(this.#u,t),this.#u=t)}delete(t){return this.#N(t,"delete")}#N(t,e){var r,n,o,a;let i=!1;if(this.#h!==0){let l=this.#a.get(t);if(l!==void 0)if(i=!0,this.#h===1)this.#W(e);else{this.#I(l);let h=this.#r[l];if(this.#c(h)?h.__abortController.abort(new Error("deleted")):(this.#v||this.#p)&&(this.#v&&((r=this.#n)==null||r.call(this,h,t,e)),this.#p&&((n=this.#m)==null||n.push([h,t,e]))),this.#a.delete(t),this.#l[l]=void 0,this.#r[l]=void 0,l===this.#u)this.#u=this.#w[l];else if(l===this.#d)this.#d=this.#g[l];else{let c=this.#w[l];this.#g[c]=this.#g[l];let f=this.#g[l];this.#w[f]=this.#w[l]}this.#h--,this.#E.push(l)}}if(this.#p&&((o=this.#m)!=null&&o.length)){let l=this.#m,h;for(;h=l==null?void 0:l.shift();)(a=this.#s)==null||a.call(this,...h)}return i}clear(){return this.#W("delete")}#W(t){var e,i,r;for(let n of this.#F({allowStale:!0})){let o=this.#r[n];if(this.#c(o))o.__abortController.abort(new Error("deleted"));else{let a=this.#l[n];this.#v&&((e=this.#n)==null||e.call(this,o,a,t)),this.#p&&((i=this.#m)==null||i.push([o,a,t]))}}if(this.#a.clear(),this.#r.fill(void 0),this.#l.fill(void 0),this.#b&&this.#T&&(this.#b.fill(0),this.#T.fill(0)),this.#C&&this.#C.fill(0),this.#d=0,this.#u=0,this.#E.length=0,this.#f=0,this.#h=0,this.#p&&this.#m){let n=this.#m,o;for(;o=n==null?void 0:n.shift();)(r=this.#s)==null||r.call(this,...o)}}};import{posix as zn,win32 as ri}from"node:path";import{fileURLToPath as Un}from"node:url";import{lstatSync as Hn,readdir as qn,readdirSync as Yn,readlinkSync as Jn,realpathSync as Kn}from"fs";import*as Vn from"node:fs";import{lstat as Zn,readdir as Qn,readlink as to,realpath as eo}from"node:fs/promises";import{EventEmitter as ei}from"node:events";import ys from"node:stream";import{StringDecoder as In}from"node:string_decoder";var ps=typeof process=="object"&&process?process:{stdout:null,stderr:null},kn=s=>!!s&&typeof s=="object"&&(s instanceof mt||s instanceof ys||Dn(s)||Mn(s)),Dn=s=>!!s&&typeof s=="object"&&s instanceof ei&&typeof s.pipe=="function"&&s.pipe!==ys.Writable.prototype.pipe,Mn=s=>!!s&&typeof s=="object"&&s instanceof ei&&typeof s.write=="function"&&typeof s.end=="function",lt=Symbol("EOF"),ht=Symbol("maybeEmitEnd"),pt=Symbol("emittedEnd"),ue=Symbol("emittingEnd"),zt=Symbol("emittedError"),de=Symbol("closed"),ms=Symbol("read"),pe=Symbol("flush"),gs=Symbol("flushChunk"),Q=Symbol("encoding"),Rt=Symbol("decoder"),N=Symbol("flowing"),Ut=Symbol("paused"),Ft=Symbol("resume"),L=Symbol("buffer"),_=Symbol("pipes"),I=Symbol("bufferLength"),Ke=Symbol("bufferPush"),me=Symbol("bufferShift"),D=Symbol("objectMode"),F=Symbol("destroyed"),Ve=Symbol("error"),Xe=Symbol("emitData"),ws=Symbol("emitEnd"),Ze=Symbol("emitEnd2"),st=Symbol("async"),Qe=Symbol("abort"),ge=Symbol("aborted"),Ht=Symbol("signal"),yt=Symbol("dataListeners"),G=Symbol("discarded"),qt=s=>Promise.resolve().then(s),_n=s=>s(),Pn=s=>s==="end"||s==="finish"||s==="prefinish",jn=s=>s instanceof ArrayBuffer||!!s&&typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,Bn=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),we=class{src;dest;opts;ondrain;constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[Ft](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},ti=class extends we{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}},Wn=s=>!!s.objectMode,Gn=s=>!s.objectMode&&!!s.encoding&&s.encoding!=="buffer",mt=class extends ei{[N]=!1;[Ut]=!1;[_]=[];[L]=[];[D];[Q];[st];[Rt];[lt]=!1;[pt]=!1;[ue]=!1;[de]=!1;[zt]=null;[I]=0;[F]=!1;[Ht];[ge]=!1;[yt]=0;[G]=!1;writable=!0;readable=!0;constructor(...t){let e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Wn(e)?(this[D]=!0,this[Q]=null):Gn(e)?(this[Q]=e.encoding,this[D]=!1):(this[D]=!1,this[Q]=null),this[st]=!!e.async,this[Rt]=this[Q]?new In(this[Q]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[L]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[_]});let{signal:i}=e;i&&(this[Ht]=i,i.aborted?this[Qe]():i.addEventListener("abort",()=>this[Qe]()))}get bufferLength(){return this[I]}get encoding(){return this[Q]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[D]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[st]}set async(t){this[st]=this[st]||!!t}[Qe](){var t,e;this[ge]=!0,this.emit("abort",(t=this[Ht])==null?void 0:t.reason),this.destroy((e=this[Ht])==null?void 0:e.reason)}get aborted(){return this[ge]}set aborted(t){}write(t,e,i){var n;if(this[ge])return!1;if(this[lt])throw new Error("write after end");if(this[F])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");let r=this[st]?qt:_n;if(!this[D]&&!Buffer.isBuffer(t)){if(Bn(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(jn(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[D]?(this[N]&&this[I]!==0&&this[pe](!0),this[N]?this.emit("data",t):this[Ke](t),this[I]!==0&&this.emit("readable"),i&&r(i),this[N]):t.length?(typeof t=="string"&&!(e===this[Q]&&!((n=this[Rt])!=null&&n.lastNeed))&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[Q]&&(t=this[Rt].write(t)),this[N]&&this[I]!==0&&this[pe](!0),this[N]?this.emit("data",t):this[Ke](t),this[I]!==0&&this.emit("readable"),i&&r(i),this[N]):(this[I]!==0&&this.emit("readable"),i&&r(i),this[N])}read(t){if(this[F])return null;if(this[G]=!1,this[I]===0||t===0||t&&t>this[I])return this[ht](),null;this[D]&&(t=null),this[L].length>1&&!this[D]&&(this[L]=[this[Q]?this[L].join(""):Buffer.concat(this[L],this[I])]);let e=this[ms](t||null,this[L][0]);return this[ht](),e}[ms](t,e){if(this[D])this[me]();else{let i=e;t===i.length||t===null?this[me]():typeof i=="string"?(this[L][0]=i.slice(t),e=i.slice(0,t),this[I]-=t):(this[L][0]=i.subarray(t),e=i.subarray(0,t),this[I]-=t)}return this.emit("data",e),!this[L].length&&!this[lt]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e="utf8"),t!==void 0&&this.write(t,e),i&&this.once("end",i),this[lt]=!0,this.writable=!1,(this[N]||!this[Ut])&&this[ht](),this}[Ft](){this[F]||(!this[yt]&&!this[_].length&&(this[G]=!0),this[Ut]=!1,this[N]=!0,this.emit("resume"),this[L].length?this[pe]():this[lt]?this[ht]():this.emit("drain"))}resume(){return this[Ft]()}pause(){this[N]=!1,this[Ut]=!0,this[G]=!1}get destroyed(){return this[F]}get flowing(){return this[N]}get paused(){return this[Ut]}[Ke](t){this[D]?this[I]+=1:this[I]+=t.length,this[L].push(t)}[me](){return this[D]?this[I]-=1:this[I]-=this[L][0].length,this[L].shift()}[pe](t=!1){do;while(this[gs](this[me]())&&this[L].length);!t&&!this[L].length&&!this[lt]&&this.emit("drain")}[gs](t){return this.emit("data",t),this[N]}pipe(t,e){if(this[F])return t;this[G]=!1;let i=this[pt];return e=e||{},t===ps.stdout||t===ps.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[_].push(e.proxyErrors?new ti(this,t,e):new we(this,t,e)),this[st]?qt(()=>this[Ft]()):this[Ft]()),t}unpipe(t){let e=this[_].find(i=>i.dest===t);e&&(this[_].length===1?(this[N]&&this[yt]===0&&(this[N]=!1),this[_]=[]):this[_].splice(this[_].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let i=super.on(t,e);if(t==="data")this[G]=!1,this[yt]++,!this[_].length&&!this[N]&&this[Ft]();else if(t==="readable"&&this[I]!==0)super.emit("readable");else if(Pn(t)&&this[pt])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[zt]){let r=e;this[st]?qt(()=>r.call(this,this[zt])):r.call(this,this[zt])}return i}removeListener(t,e){return this.off(t,e)}off(t,e){let i=super.off(t,e);return t==="data"&&(this[yt]=this.listeners("data").length,this[yt]===0&&!this[G]&&!this[_].length&&(this[N]=!1)),i}removeAllListeners(t){let e=super.removeAllListeners(t);return(t==="data"||t===void 0)&&(this[yt]=0,!this[G]&&!this[_].length&&(this[N]=!1)),e}get emittedEnd(){return this[pt]}[ht](){!this[ue]&&!this[pt]&&!this[F]&&this[L].length===0&&this[lt]&&(this[ue]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[de]&&this.emit("close"),this[ue]=!1)}emit(t,...e){let i=e[0];if(t!=="error"&&t!=="close"&&t!==F&&this[F])return!1;if(t==="data")return!this[D]&&!i?!1:this[st]?(qt(()=>this[Xe](i)),!0):this[Xe](i);if(t==="end")return this[ws]();if(t==="close"){if(this[de]=!0,!this[pt]&&!this[F])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[zt]=i,super.emit(Ve,i);let n=!this[Ht]||this.listeners("error").length?super.emit("error",i):!1;return this[ht](),n}else if(t==="resume"){let n=super.emit("resume");return this[ht](),n}else if(t==="finish"||t==="prefinish"){let n=super.emit(t);return this.removeAllListeners(t),n}let r=super.emit(t,...e);return this[ht](),r}[Xe](t){for(let i of this[_])i.dest.write(t)===!1&&this.pause();let e=this[G]?!1:super.emit("data",t);return this[ht](),e}[ws](){return this[pt]?!1:(this[pt]=!0,this.readable=!1,this[st]?(qt(()=>this[Ze]()),!0):this[Ze]())}[Ze](){if(this[Rt]){let e=this[Rt].end();if(e){for(let i of this[_])i.dest.write(e);this[G]||super.emit("data",e)}}for(let e of this[_])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){let t=Object.assign([],{dataLength:0});this[D]||(t.dataLength=0);let e=this.promise();return this.on("data",i=>{t.push(i),this[D]||(t.dataLength+=i.length)}),await e,t}async concat(){if(this[D])throw new Error("cannot concat in objectMode");let t=await this.collect();return this[Q]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(F,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[Symbol.asyncIterator](){this[G]=!1;let t=!1,e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[lt])return e();let n,o,a=f=>{this.off("data",l),this.off("end",h),this.off(F,c),e(),o(f)},l=f=>{this.off("error",a),this.off("end",h),this.off(F,c),this.pause(),n({value:f,done:!!this[lt]})},h=()=>{this.off("error",a),this.off("data",l),this.off(F,c),e(),n({done:!0,value:void 0})},c=()=>a(new Error("stream destroyed"));return new Promise((f,d)=>{o=d,n=f,this.once(F,c),this.once("error",a),this.once("end",h),this.once("data",l)})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[G]=!1;let t=!1,e=()=>(this.pause(),this.off(Ve,e),this.off(F,e),this.off("end",e),t=!0,{done:!0,value:void 0}),i=()=>{if(t)return e();let r=this.read();return r===null?e():{done:!1,value:r}};return this.once("end",e),this.once(Ve,e),this.once(F,e),{next:i,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[F])return t?this.emit("error",t):this.emit(F),this;this[F]=!0,this[G]=!0,this[L].length=0,this[I]=0;let e=this;return typeof e.close=="function"&&!this[de]&&e.close(),t?this.emit("error",t):this.emit(F),this}static get isStream(){return kn}};var Xn=Kn.native,Jt={lstatSync:Hn,readdir:qn,readdirSync:Yn,readlinkSync:Jn,realpathSync:Xn,promises:{lstat:Zn,readdir:Qn,readlink:to,realpath:eo}},Es=s=>!s||s===Jt||s===Vn?Jt:{...Jt,...s,promises:{...Jt.promises,...s.promises||{}}},Cs=/^\\\\\?\\([a-z]:)\\?$/i,io=s=>s.replace(/\//g,"\\").replace(Cs,"$1\\"),so=/[\\\/]/,J=0,Ts=1,Os=2,rt=4,Rs=6,Fs=8,bt=10,As=12,Y=15,Yt=~Y,ii=16,bs=32,Kt=64,tt=128,ye=256,Se=512,Ss=Kt|tt|Se,ro=1023,si=s=>s.isFile()?Fs:s.isDirectory()?rt:s.isSymbolicLink()?bt:s.isCharacterDevice()?Os:s.isBlockDevice()?Rs:s.isSocket()?As:s.isFIFO()?Ts:J,vs=new Map,Vt=s=>{let t=vs.get(s);if(t)return t;let e=s.normalize("NFKD");return vs.set(s,e),e},xs=new Map,be=s=>{let t=xs.get(s);if(t)return t;let e=Vt(s.toLowerCase());return xs.set(s,e),e},ve=class extends Gt{constructor(){super({max:256})}},ni=class extends Gt{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1})}},$s=Symbol("PathScurry setAsCwd"),M=class{name;root;roots;parent;nocase;isCWD=!1;#t;#e;get dev(){return this.#e}#n;get mode(){return this.#n}#s;get nlink(){return this.#s}#o;get uid(){return this.#o}#S;get gid(){return this.#S}#h;get rdev(){return this.#h}#f;get blksize(){return this.#f}#a;get ino(){return this.#a}#l;get size(){return this.#l}#r;get blocks(){return this.#r}#g;get atimeMs(){return this.#g}#w;get mtimeMs(){return this.#w}#d;get ctimeMs(){return this.#d}#u;get birthtimeMs(){return this.#u}#E;get atime(){return this.#E}#m;get mtime(){return this.#m}#C;get ctime(){return this.#C}#T;get birthtime(){return this.#T}#b;#v;#x;#p;#A;#O;#i;#L;#y;#$;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(t,e=J,i,r,n,o,a){this.name=t,this.#b=n?be(t):Vt(t),this.#i=e&ro,this.nocase=n,this.roots=r,this.root=i||this,this.#L=o,this.#x=a.fullpath,this.#A=a.relative,this.#O=a.relativePosix,this.parent=a.parent,this.parent?this.#t=this.parent.#t:this.#t=Es(a.fs)}depth(){return this.#v!==void 0?this.#v:this.parent?this.#v=this.parent.depth()+1:this.#v=0}childrenCache(){return this.#L}resolve(t){if(!t)return this;let e=this.getRootString(t),r=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#I(r):this.#I(r)}#I(t){let e=this;for(let i of t)e=e.child(i);return e}children(){let t=this.#L.get(this);if(t)return t;let e=Object.assign([],{provisional:0});return this.#L.set(this,e),this.#i&=~ii,e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;let i=this.children(),r=this.nocase?be(t):Vt(t);for(let l of i)if(l.#b===r)return l;let n=this.parent?this.sep:"",o=this.#x?this.#x+n+t:void 0,a=this.newChild(t,J,{...e,parent:this,fullpath:o});return this.canReaddir()||(a.#i|=tt),i.push(a),a}relative(){if(this.isCWD)return"";if(this.#A!==void 0)return this.#A;let t=this.name,e=this.parent;if(!e)return this.#A=this.name;let i=e.relative();return i+(!i||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#O!==void 0)return this.#O;let t=this.name,e=this.parent;if(!e)return this.#O=this.fullpathPosix();let i=e.relativePosix();return i+(!i||!e.parent?"":"/")+t}fullpath(){if(this.#x!==void 0)return this.#x;let t=this.name,e=this.parent;if(!e)return this.#x=this.name;let r=e.fullpath()+(e.parent?this.sep:"")+t;return this.#x=r}fullpathPosix(){if(this.#p!==void 0)return this.#p;if(this.sep==="/")return this.#p=this.fullpath();if(!this.parent){let r=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(r)?this.#p=`//?/${r}`:this.#p=r}let t=this.parent,e=t.fullpathPosix(),i=e+(!e||!t.parent?"":"/")+this.name;return this.#p=i}isUnknown(){return(this.#i&Y)===J}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#i&Y)===Fs}isDirectory(){return(this.#i&Y)===rt}isCharacterDevice(){return(this.#i&Y)===Os}isBlockDevice(){return(this.#i&Y)===Rs}isFIFO(){return(this.#i&Y)===Ts}isSocket(){return(this.#i&Y)===As}isSymbolicLink(){return(this.#i&bt)===bt}lstatCached(){return this.#i&bs?this:void 0}readlinkCached(){return this.#y}realpathCached(){return this.#$}readdirCached(){let t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#y)return!0;if(!this.parent)return!1;let t=this.#i&Y;return!(t!==J&&t!==bt||this.#i&ye||this.#i&tt)}calledReaddir(){return!!(this.#i&ii)}isENOENT(){return!!(this.#i&tt)}isNamed(t){return this.nocase?this.#b===be(t):this.#b===Vt(t)}async readlink(){var e;let t=this.#y;if(t)return t;if(this.canReadlink()&&this.parent)try{let i=await this.#t.promises.readlink(this.fullpath()),r=(e=await this.parent.realpath())==null?void 0:e.resolve(i);if(r)return this.#y=r}catch(i){this.#c(i.code);return}}readlinkSync(){var e;let t=this.#y;if(t)return t;if(this.canReadlink()&&this.parent)try{let i=this.#t.readlinkSync(this.fullpath()),r=(e=this.parent.realpathSync())==null?void 0:e.resolve(i);if(r)return this.#y=r}catch(i){this.#c(i.code);return}}#k(t){this.#i|=ii;for(let e=t.provisional;e<t.length;e++){let i=t[e];i&&i.#D()}}#D(){this.#i&tt||(this.#i=(this.#i|tt)&Yt,this.#R())}#R(){let t=this.children();t.provisional=0;for(let e of t)e.#D()}#F(){this.#i|=Se,this.#M()}#M(){if(this.#i&Kt)return;let t=this.#i;(t&Y)===rt&&(t&=Yt),this.#i=t|Kt,this.#R()}#_(t=""){t==="ENOTDIR"||t==="EPERM"?this.#M():t==="ENOENT"?this.#D():this.children().provisional=0}#P(t=""){t==="ENOTDIR"?this.parent.#M():t==="ENOENT"&&this.#D()}#c(t=""){let e=this.#i;e|=ye,t==="ENOENT"&&(e|=tt),(t==="EINVAL"||t==="UNKNOWN")&&(e&=Yt),this.#i=e,t==="ENOTDIR"&&this.parent&&this.parent.#M()}#j(t,e){return this.#N(t,e)||this.#B(t,e)}#B(t,e){let i=si(t),r=this.newChild(t.name,i,{parent:this}),n=r.#i&Y;return n!==rt&&n!==bt&&n!==J&&(r.#i|=Kt),e.unshift(r),e.provisional++,r}#N(t,e){for(let i=e.provisional;i<e.length;i++){let r=e[i];if((this.nocase?be(t.name):Vt(t.name))===r.#b)return this.#W(t,r,i,e)}}#W(t,e,i,r){let n=e.name;return e.#i=e.#i&Yt|si(t),n!==t.name&&(e.name=t.name),i!==r.provisional&&(i===r.length-1?r.pop():r.splice(i,1),r.unshift(e)),r.provisional++,e}async lstat(){if(!(this.#i&tt))try{return this.#H(await this.#t.promises.lstat(this.fullpath())),this}catch(t){this.#P(t.code)}}lstatSync(){if(!(this.#i&tt))try{return this.#H(this.#t.lstatSync(this.fullpath())),this}catch(t){this.#P(t.code)}}#H(t){let{atime:e,atimeMs:i,birthtime:r,birthtimeMs:n,blksize:o,blocks:a,ctime:l,ctimeMs:h,dev:c,gid:f,ino:d,mode:p,mtime:w,mtimeMs:m,nlink:b,rdev:g,size:S,uid:v}=t;this.#E=e,this.#g=i,this.#T=r,this.#u=n,this.#f=o,this.#r=a,this.#C=l,this.#d=h,this.#e=c,this.#S=f,this.#a=d,this.#n=p,this.#m=w,this.#w=m,this.#s=b,this.#h=g,this.#l=S,this.#o=v;let y=si(t);this.#i=this.#i&Yt|y|bs,y!==J&&y!==rt&&y!==bt&&(this.#i|=Kt)}#z=[];#U=!1;#q(t){this.#U=!1;let e=this.#z.slice();this.#z.length=0,e.forEach(i=>i(null,t))}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}let i=this.children();if(this.calledReaddir()){let n=i.slice(0,i.provisional);e?t(null,n):queueMicrotask(()=>t(null,n));return}if(this.#z.push(t),this.#U)return;this.#U=!0;let r=this.fullpath();this.#t.readdir(r,{withFileTypes:!0},(n,o)=>{if(n)this.#_(n.code),i.provisional=0;else{for(let a of o)this.#j(a,i);this.#k(i)}this.#q(i.slice(0,i.provisional))})}#G;async readdir(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();if(this.#G)await this.#G;else{let i=()=>{};this.#G=new Promise(r=>i=r);try{for(let r of await this.#t.promises.readdir(e,{withFileTypes:!0}))this.#j(r,t);this.#k(t)}catch(r){this.#_(r.code),t.provisional=0}this.#G=void 0,i()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();try{for(let i of this.#t.readdirSync(e,{withFileTypes:!0}))this.#j(i,t);this.#k(t)}catch(i){this.#_(i.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(this.#i&Ss)return!1;let t=Y&this.#i;return t===J||t===rt||t===bt}shouldWalk(t,e){return(this.#i&rt)===rt&&!(this.#i&Ss)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#$)return this.#$;if(!((Se|ye|tt)&this.#i))try{let t=await this.#t.promises.realpath(this.fullpath());return this.#$=this.resolve(t)}catch{this.#F()}}realpathSync(){if(this.#$)return this.#$;if(!((Se|ye|tt)&this.#i))try{let t=this.#t.realpathSync(this.fullpath());return this.#$=this.resolve(t)}catch{this.#F()}}[$s](t){if(t===this)return;t.isCWD=!1,this.isCWD=!0;let e=new Set([]),i=[],r=this;for(;r&&r.parent;)e.add(r),r.#A=i.join(this.sep),r.#O=i.join("/"),r=r.parent,i.push("..");for(r=t;r&&r.parent&&!e.has(r);)r.#A=void 0,r.#O=void 0,r=r.parent}},xe=class s extends M{sep="\\";splitSep=so;constructor(t,e=J,i,r,n,o,a){super(t,e,i,r,n,o,a)}newChild(t,e=J,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}getRootString(t){return ri.parse(t).root}getRoot(t){if(t=io(t.toUpperCase()),t===this.root.name)return this.root;for(let[e,i]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=i;return this.roots[t]=new At(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(Cs,"$1\\"),t===e}},Ee=class s extends M{splitSep="/";sep="/";constructor(t,e=J,i,r,n,o,a){super(t,e,i,r,n,o,a)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=J,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}},Ce=class{root;rootPath;roots;cwd;#t;#e;#n;nocase;#s;constructor(t=process.cwd(),e,i,{nocase:r,childrenCacheSize:n=16*1024,fs:o=Jt}={}){this.#s=Es(o),(t instanceof URL||t.startsWith("file://"))&&(t=Un(t));let a=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(a),this.#t=new ve,this.#e=new ve,this.#n=new ni(n);let l=a.substring(this.rootPath.length).split(i);if(l.length===1&&!l[0]&&l.pop(),r===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=r,this.root=this.newRoot(this.#s),this.roots[this.rootPath]=this.root;let h=this.root,c=l.length-1,f=e.sep,d=this.rootPath,p=!1;for(let w of l){let m=c--;h=h.child(w,{relative:new Array(m).fill("..").join(f),relativePosix:new Array(m).fill("..").join("/"),fullpath:d+=(p?"":f)+w}),p=!0}this.cwd=h}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#n}resolve(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#t.get(e);if(i!==void 0)return i;let r=this.cwd.resolve(e).fullpath();return this.#t.set(e,r),r}resolvePosix(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#e.get(e);if(i!==void 0)return i;let r=this.cwd.resolve(e).fullpathPosix();return this.#e.set(e,r),r}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i}=e;if(t.canReaddir()){let r=await t.readdir();return i?r:r.map(n=>n.name)}else return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0}=e;return t.canReaddir()?i?t.readdirSync():t.readdirSync().map(r=>r.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t.withFileTypes,t=this.cwd);let i=await t.readlink();return e?i:i==null?void 0:i.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t.withFileTypes,t=this.cwd);let i=t.readlinkSync();return e?i:i==null?void 0:i.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t.withFileTypes,t=this.cwd);let i=await t.realpath();return e?i:i==null?void 0:i.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t.withFileTypes,t=this.cwd);let i=t.realpathSync();return e?i:i==null?void 0:i.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(i?t:t.fullpath());let l=new Set,h=(f,d)=>{l.add(f),f.readdirCB((p,w)=>{if(p)return d(p);let m=w.length;if(!m)return d();let b=()=>{--m===0&&d()};for(let g of w)(!n||n(g))&&a.push(i?g:g.fullpath()),r&&g.isSymbolicLink()?g.realpath().then(S=>S!=null&&S.isUnknown()?S.lstat():S).then(S=>S!=null&&S.shouldWalk(l,o)?h(S,b):b()):g.shouldWalk(l,o)?h(g,b):b()},!0)},c=t;return new Promise((f,d)=>{h(c,p=>{if(p)return d(p);f(a)})})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(i?t:t.fullpath());let l=new Set([t]);for(let h of l){let c=h.readdirSync();for(let f of c){(!n||n(f))&&a.push(i?f:f.fullpath());let d=f;if(f.isSymbolicLink()){if(!(r&&(d=f.realpathSync())))continue;d.isUnknown()&&d.lstatSync()}d.shouldWalk(l,o)&&l.add(d)}}return a}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e;(!n||n(t))&&(yield i?t:t.fullpath());let a=new Set([t]);for(let l of a){let h=l.readdirSync();for(let c of h){(!n||n(c))&&(yield i?c:c.fullpath());let f=c;if(c.isSymbolicLink()){if(!(r&&(f=c.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(a,o)&&a.add(f)}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new mt({objectMode:!0});(!n||n(t))&&a.write(i?t:t.fullpath());let l=new Set,h=[t],c=0,f=()=>{let d=!1;for(;!d;){let p=h.shift();if(!p){c===0&&a.end();return}c++,l.add(p);let w=(b,g,S=!1)=>{if(b)return a.emit("error",b);if(r&&!S){let v=[];for(let y of g)y.isSymbolicLink()&&v.push(y.realpath().then(x=>x!=null&&x.isUnknown()?x.lstat():x));if(v.length){Promise.all(v).then(()=>w(null,g,!0));return}}for(let v of g)v&&(!n||n(v))&&(a.write(i?v:v.fullpath())||(d=!0));c--;for(let v of g){let y=v.realpathCached()||v;y.shouldWalk(l,o)&&h.push(y)}d&&!a.flowing?a.once("drain",f):m||f()},m=!0;p.readdirCB(w,!0),m=!1}};return f(),a}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof M||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new mt({objectMode:!0}),l=new Set;(!n||n(t))&&a.write(i?t:t.fullpath());let h=[t],c=0,f=()=>{let d=!1;for(;!d;){let p=h.shift();if(!p){c===0&&a.end();return}c++,l.add(p);let w=p.readdirSync();for(let m of w)(!n||n(m))&&(a.write(i?m:m.fullpath())||(d=!0));c--;for(let m of w){let b=m;if(m.isSymbolicLink()){if(!(r&&(b=m.realpathSync())))continue;b.isUnknown()&&b.lstatSync()}b.shouldWalk(l,o)&&h.push(b)}}d&&!a.flowing&&a.once("drain",f)};return f(),a}chdir(t=this.cwd){let e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[$s](e)}},At=class extends Ce{sep="\\";constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,ri,"\\",{...e,nocase:i}),this.nocase=i;for(let r=this.cwd;r;r=r.parent)r.nocase=this.nocase}parseRootPath(t){return ri.parse(t).root.toUpperCase()}newRoot(t){return new xe(this.rootPath,rt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}},$t=class extends Ce{sep="/";constructor(t=process.cwd(),e={}){let{nocase:i=!1}=e;super(t,zn,"/",{...e,nocase:i}),this.nocase=i}parseRootPath(t){return"/"}newRoot(t){return new Ee(this.rootPath,rt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}},Xt=class extends $t{constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,{...e,nocase:i})}},vl=process.platform==="win32"?xe:Ee,Ns=process.platform==="win32"?At:process.platform==="darwin"?Xt:$t;var no=s=>s.length>=1,oo=s=>s.length>=1,Nt=class s{#t;#e;#n;length;#s;#o;#S;#h;#f;#a;#l=!0;constructor(t,e,i,r){if(!no(t))throw new TypeError("empty pattern list");if(!oo(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,i<0||i>=this.length)throw new TypeError("index out of range");if(this.#t=t,this.#e=e,this.#n=i,this.#s=r,this.#n===0){if(this.isUNC()){let[n,o,a,l,...h]=this.#t,[c,f,d,p,...w]=this.#e;h[0]===""&&(h.shift(),w.shift());let m=[n,o,a,l,""].join("/"),b=[c,f,d,p,""].join("/");this.#t=[m,...h],this.#e=[b,...w],this.length=this.#t.length}else if(this.isDrive()||this.isAbsolute()){let[n,...o]=this.#t,[a,...l]=this.#e;o[0]===""&&(o.shift(),l.shift());let h=n+"/",c=a+"/";this.#t=[h,...o],this.#e=[c,...l],this.length=this.#t.length}}}pattern(){return this.#t[this.#n]}isString(){return typeof this.#t[this.#n]=="string"}isGlobstar(){return this.#t[this.#n]===k}isRegExp(){return this.#t[this.#n]instanceof RegExp}globString(){return this.#S=this.#S||(this.#n===0?this.isAbsolute()?this.#e[0]+this.#e.slice(1).join("/"):this.#e.join("/"):this.#e.slice(this.#n).join("/"))}hasMore(){return this.length>this.#n+1}rest(){return this.#o!==void 0?this.#o:this.hasMore()?(this.#o=new s(this.#t,this.#e,this.#n+1,this.#s),this.#o.#a=this.#a,this.#o.#f=this.#f,this.#o.#h=this.#h,this.#o):this.#o=null}isUNC(){let t=this.#t;return this.#f!==void 0?this.#f:this.#f=this.#s==="win32"&&this.#n===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3]}isDrive(){let t=this.#t;return this.#h!==void 0?this.#h:this.#h=this.#s==="win32"&&this.#n===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0])}isAbsolute(){let t=this.#t;return this.#a!==void 0?this.#a:this.#a=t[0]===""&&t.length>1||this.isDrive()||this.isUNC()}root(){let t=this.#t[0];return typeof t=="string"&&this.isAbsolute()&&this.#n===0?t:""}checkFollowGlobstar(){return!(this.#n===0||!this.isGlobstar()||!this.#l)}markFollowGlobstar(){return this.#n===0||!this.isGlobstar()||!this.#l?!1:(this.#l=!1,!0)}};var ao=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",Lt=class{relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(t,{nobrace:e,nocase:i,noext:r,noglobstar:n,platform:o=ao}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=o,this.mmopts={dot:!0,nobrace:e,nocase:i,noext:r,noglobstar:n,optimizationLevel:2,platform:o,nocomment:!0,nonegate:!0};for(let a of t)this.add(a)}add(t){let e=new W(t,this.mmopts);for(let i=0;i<e.set.length;i++){let r=e.set[i],n=e.globParts[i];if(!r||!n)throw new Error("invalid pattern object");for(;r[0]==="."&&n[0]===".";)r.shift(),n.shift();let o=new Nt(r,n,0,this.platform),a=new W(o.globString(),this.mmopts),l=n[n.length-1]==="**",h=o.isAbsolute();h?this.absolute.push(a):this.relative.push(a),l&&(h?this.absoluteChildren.push(a):this.relativeChildren.push(a))}}ignored(t){let e=t.fullpath(),i=`${e}/`,r=t.relative()||".",n=`${r}/`;for(let o of this.relative)if(o.match(r)||o.match(n))return!0;for(let o of this.absolute)if(o.match(e)||o.match(i))return!0;return!1}childrenIgnored(t){let e=t.fullpath()+"/",i=(t.relative()||".")+"/";for(let r of this.relativeChildren)if(r.match(i))return!0;for(let r of this.absoluteChildren)if(r.match(e))return!0;return!1}};var oi=class s{store;constructor(t=new Map){this.store=t}copy(){return new s(new Map(this.store))}hasWalked(t,e){var i;return(i=this.store.get(t.fullpath()))==null?void 0:i.has(e.globString())}storeWalked(t,e){let i=t.fullpath(),r=this.store.get(i);r?r.add(e.globString()):this.store.set(i,new Set([e.globString()]))}},ai=class{store=new Map;add(t,e,i){let r=(e?2:0)|(i?1:0),n=this.store.get(t);this.store.set(t,n===void 0?r:r&n)}entries(){return[...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}},li=class{store=new Map;add(t,e){if(!t.canReaddir())return;let i=this.store.get(t);i?i.find(r=>r.globString()===e.globString())||i.push(e):this.store.set(t,[e])}get(t){let e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return[...this.store.keys()].filter(t=>t.canReaddir())}},Zt=class s{hasWalkedCache;matches=new ai;subwalks=new li;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new oi}processPatterns(t,e){this.patterns=e;let i=e.map(r=>[t,r]);for(let[r,n]of i){this.hasWalkedCache.storeWalked(r,n);let o=n.root(),a=n.isAbsolute()&&this.opts.absolute!==!1;if(o){r=r.resolve(o==="/"&&this.opts.root!==void 0?this.opts.root:o);let f=n.rest();if(f)n=f;else{this.matches.add(r,!0,!1);continue}}if(r.isENOENT())continue;let l,h,c=!1;for(;typeof(l=n.pattern())=="string"&&(h=n.rest());)r=r.resolve(l),n=h,c=!0;if(l=n.pattern(),h=n.rest(),c){if(this.hasWalkedCache.hasWalked(r,n))continue;this.hasWalkedCache.storeWalked(r,n)}if(typeof l=="string"){let f=l===".."||l===""||l===".";this.matches.add(r.resolve(l),a,f);continue}else if(l===k){(!r.isSymbolicLink()||this.follow||n.checkFollowGlobstar())&&this.subwalks.add(r,n);let f=h==null?void 0:h.pattern(),d=h==null?void 0:h.rest();if(!h||(f===""||f===".")&&!d)this.matches.add(r,a,f===""||f===".");else if(f===".."){let p=r.parent||r;d?this.hasWalkedCache.hasWalked(p,d)||this.subwalks.add(p,d):this.matches.add(p,a,!0)}}else l instanceof RegExp&&this.subwalks.add(r,n)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new s(this.opts,this.hasWalkedCache)}filterEntries(t,e){let i=this.subwalks.get(t),r=this.child();for(let n of e)for(let o of i){let a=o.isAbsolute(),l=o.pattern(),h=o.rest();l===k?r.testGlobstar(n,o,h,a):l instanceof RegExp?r.testRegExp(n,l,h,a):r.testString(n,l,h,a)}return r}testGlobstar(t,e,i,r){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,r,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(i&&e.checkFollowGlobstar()?this.subwalks.add(t,i):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),i){let n=i.pattern();if(typeof n=="string"&&n!==".."&&n!==""&&n!==".")this.testString(t,n,i.rest(),r);else if(n===".."){let o=t.parent||t;this.subwalks.add(o,i)}else n instanceof RegExp&&this.testRegExp(t,n,i.rest(),r)}}testRegExp(t,e,i,r){e.test(t.name)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}testString(t,e,i,r){t.isNamed(e)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}};var lo=(s,t)=>typeof s=="string"?new Lt([s],t):Array.isArray(s)?new Lt(s,t):s,Te=class{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#t=[];#e;#n;signal;maxDepth;includeChildMatches;constructor(t,e,i){if(this.patterns=t,this.path=e,this.opts=i,this.#n=!i.posix&&i.platform==="win32"?"\\":"/",this.includeChildMatches=i.includeChildMatches!==!1,(i.ignore||!this.includeChildMatches)&&(this.#e=lo(i.ignore??[],i),!this.includeChildMatches&&typeof this.#e.add!="function")){let r="cannot ignore child matches, ignore lacks add() method.";throw new Error(r)}this.maxDepth=i.maxDepth||1/0,i.signal&&(this.signal=i.signal,this.signal.addEventListener("abort",()=>{this.#t.length=0}))}#s(t){var e,i;return this.seen.has(t)||!!((i=(e=this.#e)==null?void 0:e.ignored)!=null&&i.call(e,t))}#o(t){var e,i;return!!((i=(e=this.#e)==null?void 0:e.childrenIgnored)!=null&&i.call(e,t))}pause(){this.paused=!0}resume(){var e;if((e=this.signal)!=null&&e.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=this.#t.shift());)t()}onResume(t){var e;(e=this.signal)!=null&&e.aborted||(this.paused?this.#t.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||await t.realpath(),!i)return;t=i}let n=t.isUnknown()||this.opts.stat?await t.lstat():t;if(this.opts.follow&&this.opts.nodir&&(n!=null&&n.isSymbolicLink())){let o=await n.realpath();o&&(o.isUnknown()||this.opts.stat)&&await o.lstat()}return this.matchCheckTest(n,e)}matchCheckTest(t,e){var i;return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!t.isSymbolicLink()||!((i=t.realpathCached())!=null&&i.isDirectory()))&&!this.#s(t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||t.realpathSync(),!i)return;t=i}let n=t.isUnknown()||this.opts.stat?t.lstatSync():t;if(this.opts.follow&&this.opts.nodir&&(n!=null&&n.isSymbolicLink())){let o=n.realpathSync();o&&(o!=null&&o.isUnknown()||this.opts.stat)&&o.lstatSync()}return this.matchCheckTest(n,e)}matchFinish(t,e){var n;if(this.#s(t))return;if(!this.includeChildMatches&&((n=this.#e)!=null&&n.add)){let o=`${t.relativePosix()}/**`;this.#e.add(o)}let i=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);let r=this.opts.mark&&t.isDirectory()?this.#n:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(i){let o=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(o+r)}else{let o=this.opts.posix?t.relativePosix():t.relative(),a=this.opts.dotRelative&&!o.startsWith(".."+this.#n)?"."+this.#n:"";this.matchEmit(o?a+o+r:"."+r)}}async match(t,e,i){let r=await this.matchCheck(t,i);r&&this.matchFinish(r,e)}matchSync(t,e,i){let r=this.matchCheckSync(t,i);r&&this.matchFinish(r,e)}walkCB(t,e,i){var r;(r=this.signal)!=null&&r.aborted&&i(),this.walkCB2(t,e,new Zt(this.opts),i)}walkCB2(t,e,i,r){var a;if(this.#o(t))return r();if((a=this.signal)!=null&&a.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2(t,e,i,r));return}i.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[l,h,c]of i.matches.entries())this.#s(l)||(n++,this.match(l,h,c).then(()=>o()));for(let l of i.subwalkTargets()){if(this.maxDepth!==1/0&&l.depth()>=this.maxDepth)continue;n++;let h=l.readdirCached();l.calledReaddir()?this.walkCB3(l,h,i,o):l.readdirCB((c,f)=>this.walkCB3(l,f,i,o),!0)}o()}walkCB3(t,e,i,r){i=i.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,l,h]of i.matches.entries())this.#s(a)||(n++,this.match(a,l,h).then(()=>o()));for(let[a,l]of i.subwalks.entries())n++,this.walkCB2(a,l,i.child(),o);o()}walkCBSync(t,e,i){var r;(r=this.signal)!=null&&r.aborted&&i(),this.walkCB2Sync(t,e,new Zt(this.opts),i)}walkCB2Sync(t,e,i,r){var a;if(this.#o(t))return r();if((a=this.signal)!=null&&a.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,i,r));return}i.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[l,h,c]of i.matches.entries())this.#s(l)||this.matchSync(l,h,c);for(let l of i.subwalkTargets()){if(this.maxDepth!==1/0&&l.depth()>=this.maxDepth)continue;n++;let h=l.readdirSync();this.walkCB3Sync(l,h,i,o)}o()}walkCB3Sync(t,e,i,r){i=i.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,l,h]of i.matches.entries())this.#s(a)||this.matchSync(a,l,h);for(let[a,l]of i.subwalks.entries())n++,this.walkCB2Sync(a,l,i.child(),o);o()}},Qt=class extends Te{matches=new Set;constructor(t,e,i){super(t,e,i)}matchEmit(t){this.matches.add(t)}async walk(){var t;if((t=this.signal)!=null&&t.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((e,i)=>{this.walkCB(this.path,this.patterns,()=>{var r;(r=this.signal)!=null&&r.aborted?i(this.signal.reason):e(this.matches)})}),this.matches}walkSync(){var t;if((t=this.signal)!=null&&t.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{var e;if((e=this.signal)!=null&&e.aborted)throw this.signal.reason}),this.matches}},te=class extends Te{results;constructor(t,e,i){super(t,e,i),this.results=new mt({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){let t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end())}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var co=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",et=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=ho(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.includeChildMatches=e.includeChildMatches!==!1,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(l=>l.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(l=>l.includes("/")?l:`./**/${l}`)}if(this.pattern=t,this.platform=e.platform||co,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let l=e.platform==="win32"?At:e.platform==="darwin"?Xt:e.platform?$t:Ns;this.scurry=new l(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;let i=this.platform==="darwin"||this.platform==="win32",r={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:i,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},n=this.pattern.map(l=>new W(l,r)),[o,a]=n.reduce((l,h)=>(l[0].push(...h.set),l[1].push(...h.globParts),l),[[],[]]);this.patterns=o.map((l,h)=>{let c=a[h];if(!c)throw new Error("invalid pattern object");return new Nt(l,c,0,this.platform)})}async walk(){return[...await new Qt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new Qt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new te(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new te(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var hi=(s,t={})=>{Array.isArray(s)||(s=[s]);for(let e of s)if(new W(e,t).hasMagic())return!0;return!1};function Oe(s,t={}){return new et(s,t).streamSync()}function Is(s,t={}){return new et(s,t).stream()}function ks(s,t={}){return new et(s,t).walkSync()}async function Ls(s,t={}){return new et(s,t).walk()}function Re(s,t={}){return new et(s,t).iterateSync()}function Ds(s,t={}){return new et(s,t).iterate()}var fo=Oe,uo=Object.assign(Is,{sync:Oe}),po=Re,mo=Object.assign(Ds,{sync:Re}),go=Object.assign(ks,{stream:Oe,iterate:Re}),B=Object.assign(Ls,{glob:Ls,globSync:ks,sync:go,globStream:Is,stream:uo,globStreamSync:Oe,streamSync:fo,globIterate:Ds,iterate:mo,globIterateSync:Re,iterateSync:po,Glob:et,hasMagic:hi,escape:Ct,unescape:Z});B.glob=B;import Ms from"fs";import yo from"path";import wo from"path";var ee="_git";function ie(...s){return wo.join(ee,...s)}function se(){return ie("config.json")}function Fe(){return ie("snapshot.json")}var gt=[`**/${ee}/**`,ee,"**/node_modules/**","package-lock.json"];function Ae(s="."){let t=[...gt],e=yo.join(s,".gitignore");if(Ms.existsSync(e))try{let r=Ms.readFileSync(e,"utf-8").split(`
`).map(n=>n.trim()).filter(n=>n&&!n.startsWith("#")).map(n=>n.startsWith("/")?n.slice(1):n.endsWith("/")?`${n}**`:n.startsWith("*")?n:`**/${n}`);t.push(...r)}catch(i){u.debug(`Error reading .gitignore: ${i.message}`)}return t}async function nt(s="."){he(_s.join(s,ee));let t=Ae(),e=await B("**/*",{cwd:s,dot:!0,nodir:!0,ignore:gt}),i={};for(let n of e)if(!t.some(a=>R(n,a,{dot:!0}))){let a=_s.join(s,n);i[n]=$e.readFileSync(a,"utf-8")||""}let r=ie("snapshot.json");return $e.writeFileSync(r,JSON.stringify(i,null,2)),u.debug(`Created repository snapshot with ${Object.keys(i).length} files`),i}function Ne(s="."){let t=ie("snapshot.json");return $e.existsSync(t)?JSON.parse($e.readFileSync(t,"utf-8")):{}}import ci from"fs";function P(){try{let s=se();return ci.existsSync(s)?JSON.parse(ci.readFileSync(s,"utf-8")):{}}catch(s){return u.error(`Failed to read config: ${s.message}`),{}}}function z(s){try{let t=se();ci.writeFileSync(t,JSON.stringify(s,null,2)),u.debug("Config updated successfully")}catch(t){throw new Error(`Failed to write config: ${t.message}`)}}function fi(s){let e={...P(),...s};return z(e),e}async function It(s,t,e="main"){let i=`${ot}/repos/${s}/${t}/commits/${e}`;return(await wt(i)).sha}function Ps(){return P().lastCommit||null}async function js(s,t,e,i){let r=`${ot}/repos/${s}/${t}/compare/${e}...${i}`;return wt(r)}import bo from"path";import So from"fs";async function Le(s){try{u.info("Starting clone operation..."),vo(s),H();let[t,e]=s.split("/");await xo(t,e),u.success(`\u2713 Repository ${t}/${e} cloned successfully!`),u.info(`Directory: ${e}`)}catch(t){u.error(`Clone failed: ${t.message}`),process.exit(1)}}function vo(s){let[t,e]=s.split("/");if(!t||!e)throw new Error("Invalid repository format. Use owner/repo");if(So.existsSync(e))throw new Error(`Directory ${e} already exists`)}async function xo(s,t){u.info(`Cloning ${s}/${t}...`);let e=await xt(s,t);u.info(JSON.stringify(e)),ut(t);let i=process.cwd();try{process.chdir(t),he("_git");let r=await It(s,t);u.info(`Latest commit: ${r}`),await Bs(s,t);let n={remote:{origin:{owner:s,repo:t,url:`https://github.com/${s}/${t}.git`}},lastCommit:r};z(n),await nt(".")}catch(r){throw u.error(`Failed to download contents: ${r.message}`),r}finally{process.chdir(i)}}async function Bs(s,t,e=""){let i=await ze(s,t,e);for(let r of i){let n=bo.join(e,r.name);u.debug(`Processing: ${n}`),r.type==="dir"?(ut(n),await Bs(s,t,n)):r.type==="file"&&r.content&&at(n,r.content)}}import di from"fs";function Ws(){let t=P().lastCommit;return t?{hash:t,shortHash:t.substring(0,7)}:null}import ui from"fs";import Eo from"path";function Gs(s){return s.replace(/[.+^${}()|[\]\\]/g,"\\$&")}var Ie={patterns:null,mtime:0};function ct(s="."){let t=[...gt],e=Eo.join(s,".gitignore");if(ui.existsSync(e))try{let i=ui.statSync(e);i.mtimeMs>Ie.mtime&&(Ie={patterns:ui.readFileSync(e,"utf-8").split(`
`).map(o=>o.trim()).filter(o=>o&&!o.startsWith("#")).map(Co),mtime:i.mtimeMs}),Ie.patterns&&t.push(...Ie.patterns)}catch(i){u.debug(`Error reading .gitignore: ${i.message}`)}return t}function Co(s){return s.startsWith("/")&&(s=s.slice(1)),s.endsWith("/")&&(s=`${s}**`),!s.startsWith("*")&&!s.startsWith("/")&&(s=`**/${s}`),Gs(s)}function ke(s,t){let e=s.replace(/\\/g,"/");return t.some(i=>R(e,i,{dot:!0,matchBase:!0,nocase:!0}))}function zs(s){if(!s){console.log(C.yellow(`
No commits yet`));return}console.log(C.blue(`
On commit: ${s.shortHash}`))}async function Us(){try{let s=Fe();if(!di.existsSync(s))throw new Error("Not a git repository");let t=JSON.parse(di.readFileSync(s,"utf-8")),e=Object.keys(t),i=ct(),r=await B("**/*",{dot:!0,nodir:!0,ignore:i}),n=[],o=[],a=[];for(let h of e)r.includes(h)?di.readFileSync(h,"utf-8")!==t[h]&&n.push(h):a.push(h);for(let h of r)e.includes(h)||o.push(h);let l=Ws();if(zs(l),n.length===0&&o.length===0&&a.length===0){console.log(C.green(`
Working tree clean`));return}n.length>0&&(console.log(C.bold(`
Modified files:`)),n.forEach(h=>console.log(C.red(`  ${h}`)))),o.length>0&&(console.log(C.bold(`
New files:`)),o.forEach(h=>console.log(C.green(`  ${h}`)))),a.length>0&&(console.log(C.bold(`
Deleted files:`)),a.forEach(h=>console.log(C.red(`  ${h}`)))),console.log()}catch(s){u.error(`Status failed: ${s.message}`),process.exit(1)}}import Vs from"fs";function ft(){}ft.prototype={diff:function(t,e){var i,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=r.callback;typeof r=="function"&&(n=r,r={}),this.options=r;var o=this;function a(y){return n?(setTimeout(function(){n(void 0,y)},0),!0):y}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t)),e=this.removeEmpty(this.tokenize(e));var l=e.length,h=t.length,c=1,f=l+h;r.maxEditLength&&(f=Math.min(f,r.maxEditLength));var d=(i=r.timeout)!==null&&i!==void 0?i:1/0,p=Date.now()+d,w=[{oldPos:-1,lastComponent:void 0}],m=this.extractCommon(w[0],e,t,0);if(w[0].oldPos+1>=h&&m+1>=l)return a([{value:this.join(e),count:e.length}]);var b=-1/0,g=1/0;function S(){for(var y=Math.max(b,-c);y<=Math.min(g,c);y+=2){var x=void 0,E=w[y-1],A=w[y+1];E&&(w[y-1]=void 0);var j=!1;if(A){var $=A.oldPos-y;j=A&&0<=$&&$<l}var V=E&&E.oldPos+1<h;if(!j&&!V){w[y]=void 0;continue}if(!V||j&&E.oldPos+1<A.oldPos?x=o.addToPath(A,!0,void 0,0):x=o.addToPath(E,void 0,!0,1),m=o.extractCommon(x,e,t,y),x.oldPos+1>=h&&m+1>=l)return a(To(o,x.lastComponent,e,t,o.useLongestToken));w[y]=x,x.oldPos+1>=h&&(g=Math.min(g,y-1)),m+1>=l&&(b=Math.max(b,y+1))}c++}if(n)(function y(){setTimeout(function(){if(c>f||Date.now()>p)return n();S()||y()},0)})();else for(;c<=f&&Date.now()<=p;){var v=S();if(v)return v}},addToPath:function(t,e,i,r){var n=t.lastComponent;return n&&n.added===e&&n.removed===i?{oldPos:t.oldPos+r,lastComponent:{count:n.count+1,added:e,removed:i,previousComponent:n.previousComponent}}:{oldPos:t.oldPos+r,lastComponent:{count:1,added:e,removed:i,previousComponent:n}}},extractCommon:function(t,e,i,r){for(var n=e.length,o=i.length,a=t.oldPos,l=a-r,h=0;l+1<n&&a+1<o&&this.equals(e[l+1],i[a+1]);)l++,a++,h++;return h&&(t.lastComponent={count:h,previousComponent:t.lastComponent}),t.oldPos=a,l},equals:function(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function(t){for(var e=[],i=0;i<t.length;i++)t[i]&&e.push(t[i]);return e},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};function To(s,t,e,i,r){for(var n=[],o;t;)n.push(t),o=t.previousComponent,delete t.previousComponent,t=o;n.reverse();for(var a=0,l=n.length,h=0,c=0;a<l;a++){var f=n[a];if(f.removed){if(f.value=s.join(i.slice(c,c+f.count)),c+=f.count,a&&n[a-1].added){var p=n[a-1];n[a-1]=n[a],n[a]=p}}else{if(!f.added&&r){var d=e.slice(h,h+f.count);d=d.map(function(m,b){var g=i[c+b];return g.length>m.length?g:m}),f.value=s.join(d)}else f.value=s.join(e.slice(h,h+f.count));h+=f.count,f.added||(c+=f.count)}}var w=n[l-1];return l>1&&typeof w.value=="string"&&(w.added||w.removed)&&s.equals("",w.value)&&(n[l-2].value+=w.value,n.pop()),n}var Zh=new ft;var Hs=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,qs=/\S/,Ys=new ft;Ys.equals=function(s,t){return this.options.ignoreCase&&(s=s.toLowerCase(),t=t.toLowerCase()),s===t||this.options.ignoreWhitespace&&!qs.test(s)&&!qs.test(t)};Ys.tokenize=function(s){for(var t=s.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),e=0;e<t.length-1;e++)!t[e+1]&&t[e+2]&&Hs.test(t[e])&&Hs.test(t[e+2])&&(t[e]+=t[e+2],t.splice(e+1,2),e--);return t};var yi=new ft;yi.tokenize=function(s){this.options.stripTrailingCr&&(s=s.replace(/\r\n/g,`
`));var t=[],e=s.split(/(\n|\r\n)/);e[e.length-1]||e.pop();for(var i=0;i<e.length;i++){var r=e[i];i%2&&!this.options.newlineIsToken?t[t.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),t.push(r))}return t};function Oo(s,t,e){return yi.diff(s,t,e)}var Ro=new ft;Ro.tokenize=function(s){return s.split(/(\S.+?[.!?])(?=\s+|$)/)};var Fo=new ft;Fo.tokenize=function(s){return s.split(/([{}:;,]|\s+)/)};function De(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?De=function(t){return typeof t}:De=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(s)}function pi(s){return Ao(s)||$o(s)||No(s)||Lo()}function Ao(s){if(Array.isArray(s))return mi(s)}function $o(s){if(typeof Symbol<"u"&&Symbol.iterator in Object(s))return Array.from(s)}function No(s,t){if(s){if(typeof s=="string")return mi(s,t);var e=Object.prototype.toString.call(s).slice(8,-1);if(e==="Object"&&s.constructor&&(e=s.constructor.name),e==="Map"||e==="Set")return Array.from(s);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return mi(s,t)}}function mi(s,t){(t==null||t>s.length)&&(t=s.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=s[e];return i}function Lo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Io=Object.prototype.toString,re=new ft;re.useLongestToken=!0;re.tokenize=yi.tokenize;re.castInput=function(s){var t=this.options,e=t.undefinedReplacement,i=t.stringifyReplacer,r=i===void 0?function(n,o){return typeof o>"u"?e:o}:i;return typeof s=="string"?s:JSON.stringify(gi(s,null,null,r),r,"  ")};re.equals=function(s,t){return ft.prototype.equals.call(re,s.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};function gi(s,t,e,i,r){t=t||[],e=e||[],i&&(s=i(r,s));var n;for(n=0;n<t.length;n+=1)if(t[n]===s)return e[n];var o;if(Io.call(s)==="[object Array]"){for(t.push(s),o=new Array(s.length),e.push(o),n=0;n<s.length;n+=1)o[n]=gi(s[n],t,e,i,r);return t.pop(),e.pop(),o}if(s&&s.toJSON&&(s=s.toJSON()),De(s)==="object"&&s!==null){t.push(s),o={},e.push(o);var a=[],l;for(l in s)s.hasOwnProperty(l)&&a.push(l);for(a.sort(),n=0;n<a.length;n+=1)l=a[n],o[l]=gi(s[l],t,e,i,l);t.pop(),e.pop()}else o=s;return o}var wi=new ft;wi.tokenize=function(s){return s.slice()};wi.join=wi.removeEmpty=function(s){return s};function ko(s,t,e,i,r,n,o){o||(o={}),typeof o.context>"u"&&(o.context=4);var a=Oo(e,i,o);if(!a)return;a.push({value:"",lines:[]});function l(g){return g.map(function(S){return" "+S})}for(var h=[],c=0,f=0,d=[],p=1,w=1,m=function(S){var v=a[S],y=v.lines||v.value.replace(/\n$/,"").split(`
`);if(v.lines=y,v.added||v.removed){var x;if(!c){var E=a[S-1];c=p,f=w,E&&(d=o.context>0?l(E.lines.slice(-o.context)):[],c-=d.length,f-=d.length)}(x=d).push.apply(x,pi(y.map(function(gr){return(v.added?"+":"-")+gr}))),v.added?w+=y.length:p+=y.length}else{if(c)if(y.length<=o.context*2&&S<a.length-2){var A;(A=d).push.apply(A,pi(l(y)))}else{var j,$=Math.min(y.length,o.context);(j=d).push.apply(j,pi(l(y.slice(0,$))));var V={oldStart:c,oldLines:p-c+$,newStart:f,newLines:w-f+$,lines:d};if(S>=a.length-2&&y.length<=o.context){var Ei=/\n$/.test(e),mr=/\n$/.test(i),Ci=y.length==0&&d.length>V.oldLines;!Ei&&Ci&&e.length>0&&d.splice(V.oldLines,0,"\\ No newline at end of file"),(!Ei&&!Ci||!mr)&&d.push("\\ No newline at end of file")}h.push(V),c=0,f=0,d=[]}p+=y.length,w+=y.length}},b=0;b<a.length;b++)m(b);return{oldFileName:s,newFileName:t,oldHeader:r,newHeader:n,hunks:h}}function Js(s){if(Array.isArray(s))return s.map(Js).join(`
`);var t=[];s.oldFileName==s.newFileName&&t.push("Index: "+s.oldFileName),t.push("==================================================================="),t.push("--- "+s.oldFileName+(typeof s.oldHeader>"u"?"":"	"+s.oldHeader)),t.push("+++ "+s.newFileName+(typeof s.newHeader>"u"?"":"	"+s.newHeader));for(var e=0;e<s.hunks.length;e++){var i=s.hunks[e];i.oldLines===0&&(i.oldStart-=1),i.newLines===0&&(i.newStart-=1),t.push("@@ -"+i.oldStart+","+i.oldLines+" +"+i.newStart+","+i.newLines+" @@"),t.push.apply(t,i.lines)}return t.join(`
`)+`
`}function Do(s,t,e,i,r,n,o){return Js(ko(s,t,e,i,r,n,o))}function Ks(s,t,e,i,r,n){return Do(s,s,t,e,i,r,n)}import bi from"fs";function Me(s,t){let e=s.replace(/\\/g,"/");return t.some(i=>R(e,i,{dot:!0,matchBase:!0}))}function kt(s,t){let e=t[s]??"";if(bi.existsSync(s)){if(!bi.statSync(s).isFile())return;let r=bi.readFileSync(s,"utf-8");if(!(s in t)&&r===""){console.log(C.green(`
New empty file: ${s}`));return}if(r===e)return;let n=Ks(s,e,r);Mo(s,n)}else s in t&&console.log(C.red(`
Deleted: ${s}`))}function Mo(s,t){console.log(C.bold(`
Diff for ${s}:`)),t.split(`
`).slice(4).forEach(i=>{i.startsWith("+")?console.log(C.green(i)):i.startsWith("-")?console.log(C.red(i)):console.log(i)})}async function Xs(s){try{let t=Fe();if(!Vs.existsSync(t))throw new Error("Not a git repository");let e=JSON.parse(Vs.readFileSync(t,"utf-8")),i=ct();if(s)Me(s,i)||kt(s,e);else{let r=await B("**/*",{dot:!0,nodir:!0,ignore:i}),n=[...new Set([...r,...Object.keys(e)])];for(let o of n)Me(o,i)||kt(o,e)}}catch(t){u.error(`Diff failed: ${t.message}`),process.exit(1)}}import _o from"fs";import Po from"path";async function _e(s,t){var e;try{if(H(),!s)throw new Error("Commit message is required");let i=P();if(!((e=i.remote)!=null&&e.origin))throw new Error('No remote repository configured. Use "remote add" first.');let{owner:r,repo:n}=i.remote.origin,o=t.directory||".";await xt(r,n),u.info(`Pushing to ${r}/${n}...`);let l=(await B("**/*",{cwd:o,nodir:!0,ignore:ct(o)})).map(c=>({path:c,mode:"100644",type:"blob",content:_o.readFileSync(Po.join(o,c),"utf-8")})),h=await Ge(r,n,s,l);z({...i,lastCommit:h.sha}),await nt(o),u.success(`\u2713 Code pushed to https://github.com/${r}/${n}`)}catch(i){u.error(`Push failed: ${i.message}`),process.exit(1)}}import ne from"fs";import jo from"path";async function Zs(s,t,e=[],i={},r=""){if(!i){u.info("No changes to process");return}let{added:n=[],modified:o=[],deleted:a=[],renamed:l=[]}=i,h=[...n,...o];if(l.length>0){u.info(`
Renaming files:`);for(let{from:c,to:f}of l)try{ne.existsSync(c)?(ne.mkdirSync(jo.dirname(f),{recursive:!0}),ne.renameSync(c,f),u.success(`\u2713 Renamed: ${c} \u2192 ${f}`)):(h.push(f),u.debug(`Source file ${c} not found, will download ${f} as new file`))}catch(d){throw u.error(`Failed to rename ${c} to ${f}: ${d.message}`),d}}if(a.length>0){u.info(`
Deleting files:`);for(let c of a)try{ne.existsSync(c)&&(ne.unlinkSync(c),u.success(`\u2713 Deleted: ${c}`))}catch(f){u.error(`Failed to delete ${c}: ${f.message}`)}}if(h.length>0){u.info(`
Downloading files:`);for(let c of h)if(!e.includes(c))try{let f=await Bo(s,t,c,r);f!==null&&(at(c,f),u.success(`\u2713 Downloaded: ${c}`))}catch(f){u.error(`Failed to download ${c}: ${f.message}`)}}}async function Bo(s,t,e,i=""){try{let r=await _t(s,t,e,i);return r.content?Buffer.from(r.content,"base64").toString("utf-8"):r.size===0?"":null}catch(r){return u.error(`Failed to fetch file ${e}: ${r.message}`),null}}function Qs(s,t){let{modified:e,deleted:i}=s;e.length>0&&(u.info(`
Modified files:`),e.forEach(r=>{u.info(C.red(`  ${r}`)),kt(r,t)})),i.length>0&&(u.info(`
Deleted files:`),i.forEach(r=>{u.info(C.red(`  ${r}`))}))}function Wo(s){let t={added:[],modified:[],deleted:[],renamed:[]};for(let e of s)switch(e.status){case"added":t.added.push(e.filename);break;case"modified":t.modified.push(e.filename);break;case"removed":t.deleted.push(e.filename);break;case"renamed":t.renamed.push({from:e.previous_filename,to:e.filename});break}return t}async function tr(s,t,e,i){var l;let r=Ps(),n=await It(s,t);if(u.debug(`Comparing commits: ${r} -> ${n}`),!r){u.info("No local commit found, performing full sync...");let c={added:(await _t(s,t,"",n)).filter(f=>f.type==="file").map(f=>f.path),modified:[],deleted:[]};return{remoteCommit:n,changes:c}}if(r===n)return u.info("Already up to date"),{remoteCommit:n,changes:null};let o=await js(s,t,r,n);u.debug(`Found ${((l=o.files)==null?void 0:l.length)||0} changed files`);let a=Wo(o.files||[]);if(i!=null&&i.length){let h=c=>!i.some(f=>f===c||f.includes(c));a.added=a.added.filter(h),a.modified=a.modified.filter(h),a.deleted=a.deleted.filter(h),a.renamed=a.renamed.filter(({from:c,to:f})=>h(c)&&h(f))}return{remoteCommit:n,changes:a}}import er from"fs";function ir(){var s;try{let t=se();if(!er.existsSync(t))return null;let e=JSON.parse(er.readFileSync(t,"utf-8"));return(s=e.remote)!=null&&s.origin?{owner:e.remote.origin.owner,repo:e.remote.origin.repo}:null}catch(t){return u.debug(`Error reading git config: ${t.message}`),null}}import Si from"fs";async function sr(s,t){let e=await B("**/*",{dot:!0,nodir:!0,ignore:[...gt,...t]}),i=!1,r={modified:[],deleted:[]};for(let n of e)if(Si.existsSync(n)){let o=Si.readFileSync(n,"utf-8"),a=s[n]||"";o!==a&&r.modified.push(n)}for(let n of Object.keys(s))!Si.existsSync(n)&&!t.includes(n)&&r.deleted.push(n);return i=r.modified.length>0||r.deleted.length>0,{hasChanges:i,changes:r}}async function rr(s={force:!1,dryRun:!1}){var t,e,i,r;try{H();let n=ir();if(!n)throw new Error('No remote repository configured. Use "remote add" first.');let o=Ne(),a=Ae(),{hasChanges:l,changes:h}=await sr(o,a);if(l&&!s.force)throw Qs(h,o),new Error("Cannot pull with local changes. Commit or reset your changes first, or use --force to override.");let f=P().lastCommit;u.info(`${s.dryRun?"[DRY RUN] ":""}Pulling from ${n.owner}/${n.repo}`),u.info(`Current commit: ${f}`);let{remoteCommit:d,changes:p}=await tr(n.owner,n.repo,o,a);if(u.info(`Remote commit: ${d}`),p&&(u.info(`
Changes to pull:`),(t=p.renamed)!=null&&t.length&&(u.info(`
Renamed files:`),p.renamed.forEach(({from:w,to:m})=>u.info(`  * ${w} \u2192 ${m}`))),(e=p.added)!=null&&e.length&&(u.info(`
New files:`),p.added.forEach(w=>u.info(`  + ${w}`))),(i=p.modified)!=null&&i.length&&(u.info(`
Modified files:`),p.modified.forEach(w=>u.info(`  * ${w}`))),(r=p.deleted)!=null&&r.length&&(u.info(`
Deleted files:`),p.deleted.forEach(w=>u.info(`  - ${w}`)))),s.dryRun){u.info(`
[DRY RUN] No changes were made`);return}await Zs(n.owner,n.repo,a,p),fi({remote:{origin:{owner:n.owner,repo:n.repo,url:`https://github.com/${n.owner}/${n.repo}.git`}},lastCommit:d}),await nt("."),u.success("\u2713 Pull completed successfully")}catch(n){u.error(`Pull failed: ${n.message}`),process.exit(1)}}import Go from"fs";async function nr(s,t){try{if(!Go.existsSync("_git"))throw new Error("Not a git repository");switch(s){case"add":await zo(t);break;case"show":await Uo();break;default:throw new Error('Invalid command. Use "add" or "show"')}}catch(e){u.error(`Remote operation failed: ${e.message}`),process.exit(1)}}async function zo(s){if(H(),!s)throw new Error("Repository path required (format: owner/repo)");let[t,e]=s.split("/");if(!t||!e)throw new Error("Invalid repository format. Use owner/repo");await xt(t,e);let i={remote:{origin:{owner:t,repo:e,url:`https://github.com/${t}/${e}.git`}}};z(i),u.success(`\u2713 Remote origin added: ${t}/${e}`)}async function Uo(){var i;let s=P();if(!((i=s.remote)!=null&&i.origin)){u.info("No remote repository configured");return}let{owner:t,repo:e}=s.remote.origin;u.info(`origin	https://github.com/${t}/${e}.git (fetch)`),u.info(`origin	https://github.com/${t}/${e}.git (push)`)}import Ho from"fs";import qo from"path";async function or(){try{let s="_git";if(qo.basename(process.cwd())===s)throw new Error("Cannot initialize git repository inside _git directory");if(Ho.existsSync(s))throw new Error("Git repository already exists");ut(s),z({}),await nt("."),u.success("Initialized empty Git repository")}catch(s){u.error(`Init failed: ${s.message}`),process.exit(1)}}import vi from"fs";async function ar(s,t,e){try{switch(s){case"add":await Yo(t,e.path);break;case"status":await Jo();break;case"push":await Ko(t,e);break;default:throw new Error('Invalid command. Use "add", "status", or "push"')}}catch(i){u.error(`Submodule operation failed: ${i.message}`),process.exit(1)}}async function Yo(s,t){if(H(),!s)throw new Error("Repository path required (format: owner/repo)");let[e,i]=s.split("/");if(!e||!i)throw new Error("Invalid repository format. Use owner/repo");ut(t);let r=process.cwd();try{process.chdir(t),await Le(s),process.chdir(r);let n=P();n.submodules=n.submodules||{},n.submodules[t]={owner:e,repo:i},z(n),Vo(t),u.success(`\u2713 Submodule added at ${t}`)}finally{process.chdir(r)}}async function Jo(){let s=P();if(!s.submodules||Object.keys(s.submodules).length===0){u.info("No submodules configured");return}u.info(`
Submodules:`);for(let[t,{owner:e,repo:i}]of Object.entries(s.submodules))u.info(`  ${t} -> ${e}/${i}`)}async function Ko(s,t){let e=P();if(!e.submodules)throw new Error("No submodules configured");let i=process.cwd(),r=null;for(let[n,o]of Object.entries(e.submodules))if(`${o.owner}/${o.repo}`===s){r=n;break}if(!r)throw new Error(`Submodule ${s} not found`);try{process.chdir(r),await _e(t.message,{directory:"."})}finally{process.chdir(i)}}function Vo(s){let t=".gitignore",e="";vi.existsSync(t)&&(e=vi.readFileSync(t,"utf-8"),e&&!e.endsWith(`
`)&&(e+=`
`)),e.includes(s)||(e+=`${s}/
`,vi.writeFileSync(t,e),u.debug(`Updated .gitignore with ${s}`))}import oe from"fs";function lr(s,t){return oe.existsSync(s)?oe.readFileSync(s,"utf-8")!==t:!0}async function hr(s){try{if(!oe.existsSync("_git"))throw new Error("Not a git repository");let t=Ne();if(Object.keys(t).length===0)throw new Error("No snapshot found");let e=ct();s?await Xo(s,t):await Zo(t,e),u.success("Reset completed successfully")}catch(t){u.error(`Reset failed: ${t.message}`),process.exit(1)}}async function Xo(s,t){let e=ct();if(ke(s,e)){u.debug(`Skipping ignored file: ${s}`);return}if(!(s in t))throw new Error(`File ${s} not found in snapshot`);if(!lr(s,t[s])){u.debug(`Skipping unmodified file: ${s}`);return}at(s,t[s]),u.info(`Reset ${s}`)}async function Zo(s,t){let e=await B("**/*",{dot:!0,nodir:!0,ignore:t});for(let[i,r]of Object.entries(s))ke(i,t)||(lr(i,r)?(at(i,r),u.info(`Reset ${i}`)):u.debug(`Skipping unmodified file: ${i}`));for(let i of e)!(i in s)&&!ke(i,t)&&oe.existsSync(i)&&(oe.unlinkSync(i),u.info(`Removed ${i}`))}import ur from"fs";import Qo from"path";async function xi(s,t={}){let e=`${ot}${s}`,i=await fetch(e,{headers:{Authorization:`token ${process.env.GITHUB_TOKEN}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},...t});if(!i.ok){let r=await i.text();u.error(`GitHub API Error: ${i.status} ${i.statusText}`),u.debug(`Response: ${r}`);let n=new Error(`GitHub API error: ${i.status} ${i.statusText}`);throw n.status=i.status,n}return i.json()}async function cr(s,t,e,i=""){try{let r=i?`?ref=${i}`:"",n=await xi(`/repos/${s}/${t}/contents/${e}${r}`);return n.size===0?"":n.content?Buffer.from(n.content,"base64").toString("utf-8"):null}catch(r){if(r.status===404)return u.debug(`File not found: ${e}`),null;throw r}}async function fr(s,t,e="",i=""){try{let r=i?`?ref=${i}`:"",n=await xi(`/repos/${s}/${t}/contents/${e}${r}`);return Array.isArray(n)?n:[n]}catch(r){if(r.status===404)return u.debug(`Directory not found: ${e}`),[];throw r}}async function dr(s,t={}){try{u.info("Starting attach operation..."),ta(s),H();let[e,i]=s.split("/");await ea(e,i,t.commit),u.success(`\u2713 Repository ${e}/${i} attached successfully!`)}catch(e){u.error(`Attach failed: ${e.message}`),process.exit(1)}}function ta(s){let[t,e]=s.split("/");if(!t||!e)throw new Error("Invalid repository format. Use owner/repo")}async function ea(s,t,e){u.info(`Attaching ${s}/${t}...`),ur.mkdirSync("_git",{recursive:!0});let i=e||await It(s,t);u.info(`Target commit: ${i}`),await pr(s,t,"",i);let r={remote:{origin:{owner:s,repo:t,url:`https://github.com/${s}/${t}.git`}},lastCommit:i};z(r),await nt(".")}async function pr(s,t,e="",i=""){u.info(`Fetching contents for ${s}/${t}/${e}`);let r=await fr(s,t,e,i);for(let n of r){let o=e?Qo.join(e,n.name):n.name;if(n.type==="dir")ur.mkdirSync(o,{recursive:!0}),await pr(s,t,o,i);else if(n.type==="file"){let a=await cr(s,t,o,i);if(a===null){u.warn(`Failed to download ${o}`);continue}at(o,a),u.info(`Downloaded: ${o}`)}}}ia();K.name("git-api").description("GitHub CLI using GitHub API").version(process.env.npm_package_version||"1.0.0");K.command("init").description("Initialize a new git repository").action(or);K.command("clone").description("Clone a repository").argument("<repo>","Repository in format owner/repo").action(Le);K.command("attach").description("Initialize current directory and clone repository into it").argument("<repo>","Repository in format owner/repo").option("-c, --commit <hash>","Specific commit hash to attach to").action(dr);K.command("remote").description("Manage remote repositories").argument("<command>","Command to execute (add, show)").argument("[repo]","Repository in format owner/repo").action(nr);K.command("push").description("Push code to remote repository").argument("<message>","Commit message").option("-d, --directory <dir>","Directory to push",".").action((s,t)=>_e(s,t));K.command("pull").description("Pull latest changes from remote repository").option("-f, --force","Force pull even with local changes",!1).option("--dry-run","Show what would be pulled without making changes",!1).action(s=>rr(s));K.command("status").description("Show working tree status").action(Us);K.command("diff").description("Show changes between working tree and snapshot").argument("[filepath]","Optional file path to show diff for").action(Xs);K.command("reset").description("Reset working tree to last snapshot").argument("[filepath]","Optional file path to reset").action(hr);K.command("submodule").description("Manage submodules").argument("<command>","Command to execute (add, init, update, status)").argument("[repo]","Repository in format owner/repo").option("-p, --path <path>","Path where to add the submodule","repo").action((s,t,e)=>ar(s,t,e));K.parse();
